{% extends "dashboard/base.html" %}

{% load static i18n %}

{% block publisher_title %}
    {% trans "عمليات البحث المحفوظة" %}
{% endblock publisher_title %}

{% block publisher_content %}
    <!-- Header -->
    <div class="admin-dashboard-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="display-6 mb-1">
                    <i class="fas fa-bookmark me-3"></i>
                    {% trans "عمليات البحث المحفوظة" %}
                </h1>
                <p class="text-muted mb-0">{% trans "الوصول السريع إلى عمليات البحث التي قمت بحفظها" %}</p>
            </div>
        </div>
    </div>
    <section class="saved-searches-section py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    {% if saved_searches %}
                        <ul class="list-group">
                            {% for search in saved_searches %}
                                <li class="list-group-item d-flex flex-wrap justify-content-between align-items-center p-3 mb-2 shadow-sm">
                                    <div>
                                        <h5 class="mb-1">
                                            <a href="{{ search.get_absolute_url }}" class="text-decoration-none">{{ search.name }}</a>
                                        </h5>
                                        <small class="text-muted">{% trans "حفظ في" %}: {{ search.created_at|date:"d M, Y" }}</small>
                                    </div>
                                    <div class="d-flex align-items-center mt-2 mt-md-0 gap-2">
                                        {% if search.email_notifications %}
                                            <form action="{% url 'main:saved_searches' %}"
                                                  method="post"
                                                  class="d-inline-flex align-items-center">
                                                {% csrf_token %}
                                                <input type="hidden" name="search_id" value="{{ search.pk }}">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input"
                                                           type="checkbox"
                                                           role="switch"
                                                           id="notify-{{ search.pk }}"
                                                           name="email_notifications"
                                                           checked
                                                           onchange="this.form.submit()">
                                                    <label class="form-check-label" for="notify-{{ search.pk }}">{% trans "الإشعارات" %}</label>
                                                </div>
                                            </form>
                                        {% else %}
                                            <form action="{% url 'main:saved_searches' %}"
                                                  method="post"
                                                  class="d-inline">
                                                {% csrf_token %}
                                                <input type="hidden" name="search_id" value="{{ search.pk }}">
                                                <input type="hidden" name="email_notifications" value="on">
                                                <button type="submit" class="btn btn-sm btn-outline-success">{% trans "إعادة الاشتراك" %}</button>
                                            </form>
                                        {% endif %}
                                        <a href="{{ search.get_absolute_url }}"
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-search me-1"></i> {% trans "عرض النتائج" %}
                                        </a>
                                        <form action="{% url 'main:delete_saved_search' search.pk %}"
                                              method="post"
                                              class="d-inline"
                                              onsubmit="return confirm('{% trans "هل أنت متأكد أنك تريد حذف هذا البحث؟" %}');">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm btn-outline-danger">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="text-center py-5">
                            <div class="card-body">
                                <i class="fas fa-search-plus fa-4x text-muted mb-3"></i>
                                <h4 class="mb-3">{% trans "ليس لديك أي عمليات بحث محفوظة" %}</h4>
                                <p class="text-muted">{% trans "يمكنك حفظ عمليات البحث من صفحة قائمة الإعلانات للوصول إليها بسرعة لاحقًا." %}</p>
                                <a href="{% url 'main:ad_list' %}"
                                   class="btn btn-custom btn-primary-custom mt-3">
                                    <i class="fas fa-list me-2"></i> {% trans "تصفح الإعلانات" %}
                                </a>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>

{% endblock publisher_content %}

{% block extra_js %}
    {% if messages %}
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                {% for message in messages %}
                    window.showNotification("{{ message|escapejs }}", "{{ message.tags }}");
                {% endfor %}
            });
        </script>
    {% endif %}
{% endblock %}
