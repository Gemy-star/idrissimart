{% extends "dashboard/base.html" %}

{% load static i18n %}

{% block publisher_title %}
    {% trans "التقارير والإحصائيات" %} - {% trans "إدريسي مارت" %}
{% endblock publisher_title %}

{% block publisher_content %}
    <!-- Reports Header -->
    <div class="admin-dashboard-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="display-6 mb-1">
                    <i class="fas fa-chart-line me-3"></i>
                    {% trans "التقارير والإحصائيات" %}
                </h1>
                <p class="text-muted mb-0">{% trans "تحليل شامل لأداء إعلاناتك على المنصة" %}</p>
            </div>
        </div>
    </div>

    <!-- Overall Statistics -->
    <section class="stats-section mb-4">
        <h3 class="mb-3">
            <i class="fas fa-chart-bar me-2"></i>
            {% trans "الإحصائيات الإجمالية" %}
        </h3>
        <div class="row g-3">
            <div class="col-md-6 col-lg-3">
                <div class="stats-card">
                    <div class="stats-icon">
                        <i class="fas fa-bullhorn fa-2x"></i>
                    </div>
                    <h3>{{ stats.total_ads }}</h3>
                    <p>{% trans "إجمالي الإعلانات" %}</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="stats-card">
                    <div class="stats-icon text-success">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <h3>{{ stats.active_ads }}</h3>
                    <p>{% trans "إعلانات نشطة" %}</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="stats-card">
                    <div class="stats-icon text-info">
                        <i class="fas fa-eye fa-2x"></i>
                    </div>
                    <h3>{{ stats.total_views }}</h3>
                    <p>{% trans "إجمالي المشاهدات" %}</p>
                </div>
            </div>
            <div class="col-md-6 col-lg-3">
                <div class="stats-card">
                    <div class="stats-icon text-warning">
                        <i class="fas fa-star fa-2x"></i>
                    </div>
                    <h3>{{ stats.avg_views|floatformat:0 }}</h3>
                    <p>{% trans "متوسط المشاهدات" %}</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Period Statistics -->
    <section class="mb-4">
        <div class="row g-3">
            <div class="col-md-6">
                <div class="card admin-content-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar-week me-2"></i>
                            {% trans "إحصائيات هذا الأسبوع" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6 text-center">
                                <h3 class="text-primary">{{ week_stats.new_ads }}</h3>
                                <p class="text-muted mb-0">{% trans "إعلانات جديدة" %}</p>
                            </div>
                            <div class="col-6 text-center">
                                <h3 class="text-info">{{ week_stats.views }}</h3>
                                <p class="text-muted mb-0">{% trans "مشاهدات" %}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card admin-content-card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar-alt me-2"></i>
                            {% trans "إحصائيات هذا الشهر" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6 text-center">
                                <h3 class="text-primary">{{ month_stats.new_ads }}</h3>
                                <p class="text-muted mb-0">{% trans "إعلانات جديدة" %}</p>
                            </div>
                            <div class="col-6 text-center">
                                <h3 class="text-info">{{ month_stats.views }}</h3>
                                <p class="text-muted mb-0">{% trans "مشاهدات" %}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Premium Features Statistics -->
    <section class="mb-4">
        <div class="card admin-content-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-crown me-2"></i>
                    {% trans "المزايا المميزة" %}
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-md-4">
                        <div class="p-3">
                            <i class="fas fa-star fa-3x text-warning mb-3"></i>
                            <h4>{{ stats.highlighted_ads }}</h4>
                            <p class="text-muted mb-0">{% trans "إعلانات مميزة" %}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3">
                            <i class="fas fa-thumbtack fa-3x text-info mb-3"></i>
                            <h4>{{ stats.pinned_ads }}</h4>
                            <p class="text-muted mb-0">{% trans "إعلانات مثبتة" %}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3">
                            <i class="fas fa-bolt fa-3x text-danger mb-3"></i>
                            <h4>{{ stats.urgent_ads }}</h4>
                            <p class="text-muted mb-0">{% trans "إعلانات عاجلة" %}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Top Performing Ads -->
    <section class="mb-4">
        <div class="card admin-content-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-trophy me-2"></i>
                    {% trans "أفضل الإعلانات أداءً" %}
                </h5>
            </div>
            <div class="card-body">
                {% if top_ads %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>{% trans "العنوان" %}</th>
                                    <th>{% trans "المشاهدات" %}</th>
                                    <th>{% trans "الحالة" %}</th>
                                    <th>{% trans "تاريخ النشر" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ad in top_ads %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>
                                            <a href="{% url 'main:ad_detail' ad.pk %}" target="_blank">
                                                {{ ad.title|truncatechars:50 }}
                                            </a>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">
                                                <i class="fas fa-eye me-1"></i>
                                                {{ ad.views_count }}
                                            </span>
                                        </td>
                                        <td>
                                            {% if ad.status == 'active' %}
                                                <span class="badge bg-success">{% trans "نشط" %}</span>
                                            {% elif ad.status == 'pending' %}
                                                <span class="badge bg-warning">{% trans "قيد المراجعة" %}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{{ ad.get_status_display }}</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ ad.created_at|date:"d/m/Y" }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted text-center mb-0">{% trans "لا توجد إعلانات بعد" %}</p>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Ads by Category -->
    <section class="mb-4">
        <div class="card admin-content-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-tags me-2"></i>
                    {% trans "الإعلانات حسب التصنيف" %}
                </h5>
            </div>
            <div class="card-body">
                {% if category_stats %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>{% trans "التصنيف" %}</th>
                                    <th>{% trans "عدد الإعلانات" %}</th>
                                    <th>{% trans "إجمالي المشاهدات" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for stat in category_stats %}
                                    <tr>
                                        <td>{{ stat.category__name }}</td>
                                        <td>
                                            <span class="badge bg-primary">{{ stat.count }}</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">
                                                <i class="fas fa-eye me-1"></i>
                                                {{ stat.total_views|default:0 }}
                                            </span>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <p class="text-muted text-center mb-0">{% trans "لا توجد بيانات متاحة" %}</p>
                {% endif %}
            </div>
        </div>
    </section>

    <!-- Recent Activity -->
    <section class="mb-4">
        <div class="card admin-content-card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-history me-2"></i>
                    {% trans "النشاط الأخير" %} ({% trans "آخر 7 أيام" %})
                </h5>
            </div>
            <div class="card-body">
                {% if recent_ads %}
                    <div class="list-group list-group-flush">
                        {% for ad in recent_ads %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">
                                        <a href="{% url 'main:ad_detail' ad.pk %}" target="_blank">
                                            {{ ad.title|truncatechars:60 }}
                                        </a>
                                    </h6>
                                    <small class="text-muted">
                                        <i class="fas fa-clock me-1"></i>
                                        {{ ad.created_at|date:"d/m/Y H:i" }}
                                    </small>
                                </div>
                                <div>
                                    {% if ad.status == 'active' %}
                                        <span class="badge bg-success">{% trans "نشط" %}</span>
                                    {% elif ad.status == 'pending' %}
                                        <span class="badge bg-warning">{% trans "قيد المراجعة" %}</span>
                                    {% else %}
                                        <span class="badge bg-secondary">{{ ad.get_status_display }}</span>
                                    {% endif %}
                                    <span class="badge bg-info ms-2">
                                        <i class="fas fa-eye me-1"></i>
                                        {{ ad.views_count }}
                                    </span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted text-center mb-0">{% trans "لا يوجد نشاط حديث" %}</p>
                {% endif %}
            </div>
        </div>
    </section>

{% endblock publisher_content %}
