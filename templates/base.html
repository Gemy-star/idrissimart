{% load static compress i18n %}

{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}"
      dir="{% if LANGUAGE_CODE == 'ar' %}
               rtl
           {% else %}
               ltr
           {% endif %}"
      data-theme="light">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description"
              content="{% trans 'إدريسي مارت - منصة شاملة تجمع كافة الخدمات والمنتجات في مكان واحد' %}">
        <meta name="keywords"
              content="{% trans 'إدريسي مارت، توظيف، دورات تدريبية، خدمات، منتجات' %}">
        <meta name="author" content="Idrisi Mart">
        <title>
            {% trans "إدريسي مارت" %} -

            {% block title %}
                {% trans "الصفحة الرئيسية" %}

            {% endblock title %}
        </title>
        <!-- Bootstrap CSS (Local) -->
        <link id="bootstrap-css"
              rel="stylesheet"
              href="{% static 'bootstrap/css/bootstrap.rtl.min.css' %}">
        <!-- Swiper CSS (Local) -->
        <link rel="stylesheet" href="{% static 'swiper/swiper-bundle.min.css' %}">
        <!-- Font Awesome -->
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
        <!-- Google Fonts - Cairo -->
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap"
              rel="stylesheet">
        {% compress css %}
            <!-- Custom CSS -->
            <link id="pagestyle" href="{% static 'css/style.css' %}" rel="stylesheet">
        {% endcompress %}

        {% block extra_css %}

        {% endblock extra_css %}
    </head>
    <body style="font-family: 'Cairo', sans-serif;">
        {% include "partials/_header.html" %}

        <main>

            {% block content %}

            {% endblock content %}
        </main>
        {% include "partials/_footer.html" %}

        <!-- ============================================ -->
        <!-- CRITICAL: Load GSAP BEFORE other scripts -->
        <!-- ============================================ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js"></script>
        <!-- Bootstrap Bundle JS (Local) -->
        <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
        <!-- jQuery (Optional, for custom scripts) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <!-- Swiper JS (Local) -->
        <script src="{% static 'swiper/swiper-bundle.min.js' %}"></script>
        <!-- Custom JS - Load AFTER GSAP and jQuery -->
        {% compress js %}
            <script src="{% static 'js/main.js' %}"></script>
            <script src="{% static 'js/cart-wishlist.js' %}"></script>
            <script src="{% static 'js/test-utils.js' %}"></script>
            <script src="{% static 'js/verify-load.js' %}"></script>
        {% endcompress %}
        <!-- Language & RTL/LTR Initialization -->
        <script>
            const html = document.documentElement;
            const savedLang = localStorage.getItem('language') || '{{ LANGUAGE_CODE }}';
            html.setAttribute('lang', savedLang);
            html.setAttribute('dir', savedLang === 'ar' ? 'rtl' : 'ltr');

            // Swap Bootstrap CSS dynamically for language switching
            const bootstrapLink = document.getElementById('bootstrap-css');
            if (savedLang === 'ar') {
                bootstrapLink.href = "{% static 'bootstrap/css/bootstrap.rtl.min.css' %}";
            } else {
                bootstrapLink.href = "{% static 'bootstrap/css/bootstrap.min.css' %}";
            }
        </script>

        {% block extra_js %}

        {% endblock extra_js %}
    </body>
</html>
