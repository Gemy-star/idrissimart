{% load static compress i18n %}

{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}"
      dir="{% if LANGUAGE_CODE == 'ar' %}
               rtl
           {% else %}
               ltr
           {% endif %}"
      data-theme="light">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description"
              content="{% trans 'إدريسي مارت - منصة شاملة تجمع كافة الخدمات والمنتجات في مكان واحد' %}">
        <meta name="keywords"
              content="{% trans 'إدريسي مارت، توظيف، دورات تدريبية، خدمات، منتجات' %}">
        <meta name="author" content="Idrisi Mart">

        {% block extra_meta %}
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:site_name" content="{% trans 'إدريسي مارت' %}">
        <meta property="og:locale" content="ar_AR">

        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image">
        {% endblock extra_meta %}

        <!-- Favicon -->
        <link rel="icon"
              type="image/png"
              href="{% static 'images/logos/mini-logo-white-theme.png' %}">
        <title>
            {% trans "إدريسي مارت" %} -

            {% block title %}
                {% trans "الصفحة الرئيسية" %}

            {% endblock title %}
        </title>
        <!-- Bootstrap CSS (Local) -->
        <link id="bootstrap-css"
              rel="stylesheet"
              href="{% static 'bootstrap/css/bootstrap.rtl.min.css' %}">
        <!-- Swiper CSS (Local) -->
        <link rel="stylesheet" href="{% static 'swiper/swiper-bundle.min.css' %}">
        <!-- Font Awesome -->
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
        <!-- Google Fonts - Cairo -->
        <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap"
              rel="stylesheet">
        {% compress css %}
            <!-- Custom CSS -->
            <link id="pagestyle" href="{% static 'css/style.css' %}" rel="stylesheet">
            <link href="{% static 'css/yojad-header.css' %}" rel="stylesheet">
            <!-- Ad Visual Distinction CSS -->
            <link href="{% static 'css/ad-visual-distinction.css' %}" rel="stylesheet">
        {% endcompress %}

        {% block extra_css %}

        {% endblock extra_css %}
    </head>
    <body>
        {% include "partials/_pre_loader.html" %}
        {% include "partials/_header.html" %}

        <main>

            {% block content %}

            {% endblock content %}
        </main>
        {% include "partials/_footer.html" %}

        <!-- Compare Widget -->
        <div class="compare-widget" id="compareWidget">
            <div class="compare-toggle" id="compareToggle">
                <i class="fas fa-exchange-alt"></i>
                <span class="compare-badge" id="compareBadge">0</span>
            </div>

            <div class="compare-panel" id="comparePanel">
                <div class="compare-panel-header">
                    <h6><i class="fas fa-exchange-alt me-2"></i>{% trans "المقارنة" %}</h6>
                    <button class="compare-panel-close" id="comparePanelClose">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <div class="compare-items-list" id="compareItemsList">
                    <!-- Compare items will be populated here -->
                </div>

                <div class="compare-panel-actions">
                    <button class="btn btn-primary btn-sm" id="compareViewBtn" disabled>
                        <i class="fas fa-eye me-1"></i>{% trans "عرض المقارنة" %}
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" id="compareClearBtn">
                        <i class="fas fa-trash me-1"></i>{% trans "مسح الكل" %}
                    </button>
                </div>
            </div>
        </div>

        <!-- Back to Top Button -->
        <button class="back-to-top" id="backToTop" aria-label="Back to top">
            <i class="fas fa-arrow-up"></i>
        </button>

        <!-- Mobile Floating Post Ad Button -->
        <a href="{% url 'main:ad_create' %}" class="mobile-post-ad-btn" aria-label="{% trans 'نشر إعلان' %}">
            <i class="fas fa-plus"></i>
            <span class="mobile-post-ad-text">{% trans "نشر إعلان" %}</span>
        </a>

        <!-- Chatbot Widget -->
        {% include "chatbot/chatbot_widget.html" %}

        <!-- Modals Block for child templates -->
        {% block modals %}{% endblock %}

        <!-- ============================================ -->
        <!-- CRITICAL: Load GSAP BEFORE other scripts -->
        <!-- ============================================ -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/ScrollTrigger.min.js"></script>
        <!-- Bootstrap Bundle JS (Local) -->
        <script src="{% static 'bootstrap/js/bootstrap.bundle.min.js' %}"></script>
        <!-- jQuery (Optional, for custom scripts) -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <!-- Swiper JS (Local) -->
        <script src="{% static 'swiper/swiper-bundle.min.js' %}"></script>
        <!-- Custom JS - Load AFTER GSAP and jQuery -->
        {% compress js %}
            <script src="{% static 'js/main.js' %}"></script>
            <script src="{% static 'js/cart-wishlist.js' %}"></script>
            <script src="{% static 'js/test-utils.js' %}"></script>
            <script src="{% static 'js/verify-load.js' %}"></script>
        {% endcompress %}
        <!-- Language & RTL/LTR Initialization -->
        <script>
            const html = document.documentElement;
            const savedLang = localStorage.getItem('language') || '{{ LANGUAGE_CODE }}';
            html.setAttribute('lang', savedLang);
            html.setAttribute('dir', savedLang === 'ar' ? 'rtl' : 'ltr');

            // Swap Bootstrap CSS dynamically for language switching
            const bootstrapLink = document.getElementById('bootstrap-css');
            if (savedLang === 'ar') {
                bootstrapLink.href = "{% static 'bootstrap/css/bootstrap.rtl.min.css' %}";
            } else {
                bootstrapLink.href = "{% static 'bootstrap/css/bootstrap.min.css' %}";
            }

            // Fallback for initializeWishlistButtons if not defined elsewhere
            if (typeof initializeWishlistButtons !== 'function') {
                function initializeWishlistButtons() {}
            }

            // Initialize widgets when DOM is loaded
            document.addEventListener('DOMContentLoaded', function() {
                initializeCompareWidget();
                initializeBackToTop();
                if (typeof initializeWishlistButtons === 'function') initializeWishlistButtons();
                initializeGlobalWishlistButtons();
            });

            // Compare Widget Functionality
            function initializeCompareWidget() {
                const compareWidget = document.getElementById('compareWidget');
                const compareToggle = document.getElementById('compareToggle');
                const comparePanel = document.getElementById('comparePanel');
                const comparePanelClose = document.getElementById('comparePanelClose');
                const compareBadge = document.getElementById('compareBadge');
                const compareItemsList = document.getElementById('compareItemsList');
                const compareViewBtn = document.getElementById('compareViewBtn');
                const compareClearBtn = document.getElementById('compareClearBtn');

                let compareList = JSON.parse(localStorage.getItem('compareList')) || [];
                let isPanelOpen = false;

                // Update widget UI
                function updateCompareWidget() {
                    const count = compareList.length;

                    // Show/hide whole widget based on count
                    if (compareWidget) {
                        if (count > 0) {
                            compareWidget.style.display = 'block';
                        } else {
                            compareWidget.style.display = 'none';
                        }
                    }

                    // Update badge
                    compareBadge.textContent = count;
                    if (count > 0) {
                        compareBadge.classList.add('show');
                    } else {
                        compareBadge.classList.remove('show');
                    }

                    // Update view button
                    compareViewBtn.disabled = count < 2;

                    // Update items list
                    compareItemsList.innerHTML = '';

                    if (count === 0) {
                        compareItemsList.innerHTML = `
                            <div class="compare-empty">
                                <i class="fas fa-exchange-alt"></i>
                                <p>لا توجد عناصر للمقارنة</p>
                            </div>
                        `;
                    } else {
                        compareList.forEach(item => {
                            const itemEl = document.createElement('div');
                            itemEl.className = 'compare-item';
                            itemEl.innerHTML = `
                                <img src="${item.image}" alt="${item.title}">
                                <div class="compare-item-info">
                                    <p class="compare-item-title">${item.title}</p>
                                </div>
                                <button class="compare-item-remove" data-ad-id="${item.id}">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                            compareItemsList.appendChild(itemEl);
                        });
                    }

                    // Update all compare buttons on page
                    document.querySelectorAll('.compare-btn').forEach(btn => {
                        const adId = btn.dataset.adId;
                        if (compareList.some(item => item.id == adId)) {
                            btn.classList.add('active');
                        } else {
                            btn.classList.remove('active');
                        }
                    });
                }

                // Toggle panel
                compareToggle.addEventListener('click', function() {
                    isPanelOpen = !isPanelOpen;
                    if (isPanelOpen) {
                        comparePanel.classList.add('show');
                    } else {
                        comparePanel.classList.remove('show');
                    }
                });

                // Close panel
                comparePanelClose.addEventListener('click', function() {
                    isPanelOpen = false;
                    comparePanel.classList.remove('show');
                });

                // View comparison
                compareViewBtn.addEventListener('click', function() {
                    if (compareList.length > 1) {
                        const ids = compareList.map(item => item.id).join(',');
                        window.location.href = `{% url 'main:compare_ads' %}?ids=${ids}`;
                    }
                });

                // Clear all
                compareClearBtn.addEventListener('click', function() {
                    compareList = [];
                    localStorage.removeItem('compareList');
                    updateCompareWidget();
                });

                // Remove item
                compareItemsList.addEventListener('click', function(e) {
                    if (e.target.closest('.compare-item-remove')) {
                        const adId = e.target.closest('.compare-item-remove').dataset.adId;
                        compareList = compareList.filter(item => item.id != adId);
                        localStorage.setItem('compareList', JSON.stringify(compareList));
                        updateCompareWidget();
                    }
                });

                // Global toggle compare function
                window.toggleCompare = function(adId, button) {
                    const adTitle = button.dataset.adTitle;
                    const adImage = button.dataset.adImage;
                    const existingIndex = compareList.findIndex(item => item.id == adId);

                    if (existingIndex > -1) {
                        compareList.splice(existingIndex, 1);
                    } else {
                        if (compareList.length >= 4) {
                            showToast('يمكنك مقارنة 4 عناصر كحد أقصى', 'warning');
                            return;
                        }
                        compareList.push({ id: adId, title: adTitle, image: adImage });
                    }
                    localStorage.setItem('compareList', JSON.stringify(compareList));
                    updateCompareWidget();
                };

                // Initial update
                updateCompareWidget();

                // Attach event listeners to compare buttons
                attachCompareListeners();
            }

            // Function to attach compare button event listeners
            function attachCompareListeners() {
                document.querySelectorAll('.compare-btn').forEach(btn => {
                    // Remove existing listeners to avoid duplicates
                    btn.removeEventListener('click', handleCompareClick);
                    // Add new listener
                    btn.addEventListener('click', handleCompareClick);
                });
            }

            // Compare button click handler
            function handleCompareClick(e) {
                e.preventDefault();
                e.stopPropagation();
                const adId = this.dataset.adId;
                const adTitle = this.dataset.adTitle;
                const adImage = this.dataset.adImage;

                if (adId && adTitle && adImage) {
                    toggleCompare(adId, this);
                } else {
                    console.error('Missing data attributes for compare button:', this);
                }
            }

            // Re-attach listeners when new content is loaded (for dynamic content)
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                        // Check if any added nodes contain compare buttons
                        mutation.addedNodes.forEach(node => {
                            if (node.nodeType === 1) { // Element node
                                if (node.classList && node.classList.contains('compare-btn')) {
                                    attachCompareListeners();
                                } else if (node.querySelector && node.querySelector('.compare-btn')) {
                                    attachCompareListeners();
                                }
                            }
                        });
                    }
                });
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });

            // Back to Top Functionality
            function initializeBackToTop() {
                const backToTopBtn = document.getElementById('backToTop');

                if (backToTopBtn) {
                    // Function to calculate 25% of page height
                    function getScrollThreshold() {
                        const documentHeight = Math.max(
                            document.body.scrollHeight,
                            document.body.offsetHeight,
                            document.documentElement.clientHeight,
                            document.documentElement.scrollHeight,
                            document.documentElement.offsetHeight
                        );
                        const windowHeight = window.innerHeight;
                        const scrollableHeight = documentHeight - windowHeight;
                        return scrollableHeight * 0.25;
                    }

                    // Simple scroll handler
                    window.addEventListener('scroll', function() {
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                        const threshold = getScrollThreshold();

                        if (scrollTop > threshold) {
                            backToTopBtn.classList.add('show');
                        } else {
                            backToTopBtn.classList.remove('show');
                        }
                    });

                    // Recalculate threshold on window resize
                    window.addEventListener('resize', function() {
                        const scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                        const threshold = getScrollThreshold();

                        if (scrollTop > threshold) {
                            backToTopBtn.classList.add('show');
                        } else {
                            backToTopBtn.classList.remove('show');
                        }
                    });

                    // Smooth scroll to top when clicked
                    backToTopBtn.addEventListener('click', function(e) {
                        e.preventDefault();

                        if (window.scrollTo) {
                            window.scrollTo({
                                top: 0,
                                behavior: 'smooth'
                            });
                        } else {
                            document.documentElement.scrollTop = 0;
                            document.body.scrollTop = 0;
                        }
                    });

                    // Initial check
                    const initialScroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
                    const initialThreshold = getScrollThreshold();
                    if (initialScroll > initialThreshold) {
                        backToTopBtn.classList.add('show');
                    }
                }
            }

            // Note: toggleWishlistCard and toggleCartCard are defined in cart-wishlist.js
            // This ensures a single source of truth for cart/wishlist functionality

            // General Toast Notification System
            function showToast(message, type = 'info') {
                const colors = {
                    success: 'linear-gradient(135deg, #10b981, #059669)',
                    error: 'linear-gradient(135deg, #ef4444, #dc2626)',
                    warning: 'linear-gradient(135deg, #f59e0b, #d97706)',
                    info: 'linear-gradient(135deg, #3b82f6, #2563eb)'
                };

                const icons = {
                    success: '<i class="fas fa-check-circle"></i>',
                    error: '<i class="fas fa-times-circle"></i>',
                    warning: '<i class="fas fa-exclamation-triangle"></i>',
                    info: '<i class="fas fa-info-circle"></i>'
                };

                const toast = document.createElement('div');
                toast.className = 'toast-notification';
                toast.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: ${colors[type]};
                    color: white;
                    padding: 16px 24px;
                    border-radius: 12px;
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                    z-index: 9999;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    max-width: 400px;
                    min-width: 250px;
                    animation: slideInRight 0.3s ease;
                    font-size: 0.95rem;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                `;
                toast.innerHTML = `${icons[type]} <span>${message}</span>`;

                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 5000);
            }

            // Show wishlist notification (global)
            function showWishlistNotificationGlobal(message, type = 'success') {
                const colors = {
                    success: 'linear-gradient(135deg, #dc3545, #c82333)',
                    error: 'linear-gradient(135deg, #e74c3c, #c0392b)'
                };

                const icons = {
                    success: '❤️',
                    error: '✗'
                };

                const notification = document.createElement('div');
                notification.className = 'wishlist-notification-global';
                notification.style.cssText = `
                    position: fixed;
                    top: 100px;
                    right: 20px;
                    background: ${colors[type]};
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    box-shadow: 0 8px 25px rgba(220, 53, 69, 0.3);
                    z-index: 9999;
                    font-weight: 600;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                    max-width: 350px;
                    animation: slideInRight 0.3s ease;
                `;
                notification.innerHTML = `<span>${icons[type]}</span> ${message}`;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            // Initialize global wishlist buttons
            function initializeGlobalWishlistButtons() {
                const isAuthenticated = window.isAuthenticated || {{ user.is_authenticated|yesno:"true,false" }};

                if (!isAuthenticated) {
                    // For guest users, check localStorage and update button states
                    const guestWishlist = JSON.parse(localStorage.getItem('guestWishlist') || '[]');

                    // Update wishlist button states
                    document.querySelectorAll('.wishlist-btn-card').forEach(button => {
                        const adId = button.dataset.adId;
                        const isInWishlist = guestWishlist.some(item => item.id == adId);
                        updateWishlistButtonGlobal(button, isInWishlist);
                    });

                    // Update header wishlist count
                    updateHeaderWishlistCount(guestWishlist.length);
                }
            }

            // Note: updateHeaderWishlistCount, updateHeaderCartCount, and getCookie
            // are now defined in cart-wishlist.js for consistency

            // Get CSRF token (keep for other uses in base.html)
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            // Initialize global wishlist on page load
            document.addEventListener('DOMContentLoaded', function() {
                initializeGlobalWishlistButtons();

                // Display Django Messages as Toast notifications
                {% if messages %}
                    {% for message in messages %}
                        {# Map Django message tags to toast types #}
                        {% if message.tags == 'error' or message.tags == 'danger' %}
                            showToast('{{ message|escapejs }}', 'error');
                        {% elif message.tags == 'warning' %}
                            showToast('{{ message|escapejs }}', 'warning');
                        {% elif message.tags == 'success' %}
                            showToast('{{ message|escapejs }}', 'success');
                        {% else %}
                            showToast('{{ message|escapejs }}', 'info');
                        {% endif %}
                    {% endfor %}
                {% endif %}

                // Newsletter form submission
                const newsletterForm = document.getElementById('newsletterForm');
                if (newsletterForm) {
                    newsletterForm.addEventListener('submit', function(e) {
                        e.preventDefault();

                        const submitBtn = document.getElementById('newsletterSubmitBtn');
                        const emailInput = document.getElementById('newsletterEmail');
                        const messageDiv = document.getElementById('newsletterMessage');
                        const formData = new FormData(this);

                        // Disable submit button
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>{% trans "جارٍ الاشتراك..." %}';

                        fetch('{% url "main:newsletter_subscribe" %}', {
                            method: 'POST',
                            body: formData,
                            headers: {
                                'X-CSRFToken': getCookie('csrftoken')
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                messageDiv.className = 'mt-2 alert alert-success';
                                messageDiv.textContent = data.message;
                                messageDiv.style.display = 'block';
                                emailInput.value = '';
                                showToast(data.message, 'success');
                            } else {
                                messageDiv.className = 'mt-2 alert alert-danger';
                                messageDiv.textContent = data.message;
                                messageDiv.style.display = 'block';
                                showToast(data.message, 'error');
                            }
                        })
                        .catch(error => {
                            messageDiv.className = 'mt-2 alert alert-danger';
                            messageDiv.textContent = '{% trans "حدث خطأ أثناء الاشتراك. يرجى المحاولة مرة أخرى." %}';
                            messageDiv.style.display = 'block';
                            showToast('{% trans "حدث خطأ أثناء الاشتراك" %}', 'error');
                        })
                        .finally(() => {
                            // Re-enable submit button
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = '<i class="fas fa-paper-plane me-2"></i>{% trans "اشترك" %}';

                            // Hide message after 5 seconds
                            setTimeout(() => {
                                messageDiv.style.display = 'none';
                            }, 5000);
                        });
                    });
                }
            });

            // ============================================
            // Owner Ad Actions Functions
            // ============================================

            // Toggle Ad Visibility
            window.toggleAdVisibility = async function(adId, button) {
                if (!confirm('هل تريد تغيير حالة إظهار/إخفاء هذا الإعلان؟')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/ads/${adId}/toggle-visibility/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken'),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        showToast(data.message || 'تم تغيير حالة الإعلان بنجاح', 'success');
                        // Reload page to reflect changes
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast(data.message || 'حدث خطأ', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast('حدث خطأ في الاتصال', 'error');
                }
            };

            // Mark Ad as Sold
            window.markAdAsSold = async function(adId) {
                if (!confirm('هل تريد تحديد هذا الإعلان كـ"تم البيع"؟')) {
                    return;
                }

                try {
                    const response = await fetch(`/api/ads/${adId}/mark-sold/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken'),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        showToast(data.message || 'تم تحديد الإعلان كـ"تم البيع"', 'success');
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast(data.message || 'حدث خطأ', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast('حدث خطأ في الاتصال', 'error');
                }
            };

            // Confirm Delete Ad
            window.confirmDeleteAd = function(adId, adTitle) {
                if (confirm(`هل أنت متأكد من حذف الإعلان "${adTitle}"؟ هذا الإجراء لا يمكن التراجع عنه.`)) {
                    deleteAd(adId);
                }
            };

            // Delete Ad
            async function deleteAd(adId) {
                try {
                    const response = await fetch(`/api/ads/${adId}/delete/`, {
                        method: 'POST',
                        headers: {
                            'X-CSRFToken': getCookie('csrftoken'),
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        showToast('تم حذف الإعلان بنجاح', 'success');
                        setTimeout(() => {
                            window.location.href = '/dashboard/publisher/';
                        }, 1500);
                    } else {
                        showToast(data.message || 'حدث خطأ في حذف الإعلان', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showToast('حدث خطأ في الاتصال', 'error');
                }
            }

            // Initialize cart/wishlist on page load
            document.addEventListener('DOMContentLoaded', function() {
                console.log('[Cart/Wishlist] System initialized');
                console.log('[Cart/Wishlist] User authenticated:', window.isAuthenticated);
                console.log('[Cart/Wishlist] Cart count:', document.querySelector('.cart-count')?.textContent);
                console.log('[Cart/Wishlist] Wishlist count:', document.querySelector('.wishlist-count')?.textContent);
            });
        </script>

        {% block extra_js %}

        {% endblock extra_js %}
    </body>
</html>
