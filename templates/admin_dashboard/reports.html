{% extends "admin_dashboard/base.html" %}
{% load static i18n humanize %}

{% block title %}{% trans "التقارير والإحصائيات" %} - {% trans "لوحة التحكم" %}{% endblock %}

{% block admin_content %}
<div class="admin-header">
    <div class="admin-header-content">
        <div>
            <h1 class="admin-title">
                <i class="fas fa-chart-line me-2"></i>
                {% trans "التقارير والإحصائيات" %}
            </h1>
            <p class="admin-subtitle">{% trans "تقارير شاملة عن نشاط المنصة والمستخدمين" %}</p>
        </div>
        <div class="admin-header-actions">
            <button class="btn btn-primary" onclick="window.print()">
                <i class="fas fa-print me-2"></i>
                {% trans "طباعة التقرير" %}
            </button>
        </div>
    </div>
</div>

<!-- Visitor Statistics -->
<div class="admin-content-card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fas fa-users me-2"></i>
            {% trans "إحصائيات الزوار" %}
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3 g-md-4">
            <!-- Online Now -->
            <div class="col-6 col-sm-4 col-md-4 col-lg-2">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ online_now|default:0 }}</h3>
                        <p class="stat-label">{% trans "المتواجدون الآن" %}</p>
                    </div>
                </div>
            </div>

            <!-- Today -->
            <div class="col-6 col-sm-4 col-md-4 col-lg-2">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ visitors_today|default:0 }}</h3>
                        <p class="stat-label">{% trans "زوار اليوم" %}</p>
                    </div>
                </div>
            </div>

            <!-- Last Week -->
            <div class="col-6 col-sm-4 col-md-4 col-lg-2">
                <div class="stat-card stat-info">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ visitors_week|default:0 }}</h3>
                        <p class="stat-label">{% trans "آخر أسبوع" %}</p>
                    </div>
                </div>
            </div>

            <!-- Last Month -->
            <div class="col-6 col-sm-4 col-md-4 col-lg-2">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ visitors_month|default:0 }}</h3>
                        <p class="stat-label">{% trans "آخر شهر" %}</p>
                    </div>
                </div>
            </div>

            <!-- Last Year -->
            <div class="col-6 col-sm-4 col-md-4 col-lg-2">
                <div class="stat-card stat-danger">
                    <div class="stat-icon">
                        <i class="fas fa-calendar"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ visitors_year|default:0 }}</h3>
                        <p class="stat-label">{% trans "آخر سنة" %}</p>
                    </div>
                </div>
            </div>

            <!-- All Time -->
            <div class="col-6 col-sm-4 col-md-4 col-lg-2">
                <div class="stat-card stat-secondary">
                    <div class="stat-icon">
                        <i class="fas fa-infinity"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ visitors_total|default:0 }}</h3>
                        <p class="stat-label">{% trans "منذ البداية" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- User Statistics -->
<div class="admin-content-card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fas fa-user-friends me-2"></i>
            {% trans "إحصائيات المستخدمين" %}
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3 g-md-4">
            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ total_users|default:0|intcomma }}</h3>
                        <p class="stat-label">{% trans "إجمالي المستخدمين" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ verified_users|default:0|intcomma }}</h3>
                        <p class="stat-label">{% trans "مستخدمون موثقون" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-info">
                    <div class="stat-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ new_users_today|default:0 }}</h3>
                        <p class="stat-label">{% trans "تسجيلات اليوم" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ new_users_week|default:0 }}</h3>
                        <p class="stat-label">{% trans "تسجيلات الأسبوع" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ads Statistics -->
<div class="admin-content-card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fas fa-bullhorn me-2"></i>
            {% trans "إحصائيات الإعلانات" %}
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3 g-md-4">
            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">
                        <i class="fas fa-ad"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ total_ads|default:0|intcomma }}</h3>
                        <p class="stat-label">{% trans "إجمالي الإعلانات" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ active_ads|default:0|intcomma }}</h3>
                        <p class="stat-label">{% trans "إعلانات نشطة" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ pending_ads|default:0 }}</h3>
                        <p class="stat-label">{% trans "قيد المراجعة" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-info">
                    <div class="stat-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ ads_today|default:0 }}</h3>
                        <p class="stat-label">{% trans "إعلانات اليوم" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Categories Statistics -->
<div class="admin-content-card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fas fa-folder me-2"></i>
            {% trans "إحصائيات الأقسام" %}
        </h5>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>{% trans "القسم" %}</th>
                        <th>{% trans "عدد الإعلانات" %}</th>
                        <th>{% trans "عدد المشاهدات" %}</th>
                        <th>{% trans "النسبة" %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for category_stat in categories_stats %}
                    <tr>
                        <td>
                            <i class="fas fa-folder-open me-2"></i>
                            {{ category_stat.name }}
                        </td>
                        <td>{{ category_stat.ads_count|default:0|intcomma }}</td>
                        <td>{{ category_stat.total_views|default:0|intcomma }}</td>
                        <td>
                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar" role="progressbar"
                                     style="width: {{ category_stat.percentage }}%;"
                                     aria-valuenow="{{ category_stat.percentage }}"
                                     aria-valuemin="0" aria-valuemax="100">
                                    {{ category_stat.percentage|floatformat:1 }}%
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center text-muted">
                            {% trans "لا توجد بيانات" %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Revenue Statistics (if applicable) -->
<div class="admin-content-card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">
            <i class="fas fa-dollar-sign me-2"></i>
            {% trans "الإيرادات" %}
        </h5>
    </div>
    <div class="card-body">
        <div class="row g-3 g-md-4">
            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ revenue_today|default:0|floatformat:2 }} د.م</h3>
                        <p class="stat-label">{% trans "إيرادات اليوم" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-info">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ revenue_week|default:0|floatformat:2 }} د.م</h3>
                        <p class="stat-label">{% trans "إيرادات الأسبوع" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ revenue_month|default:0|floatformat:2 }} د.م</h3>
                        <p class="stat-label">{% trans "إيرادات الشهر" %}</p>
                    </div>
                </div>
            </div>

            <div class="col-6 col-md-6 col-lg-3">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">
                        <i class="fas fa-infinity"></i>
                    </div>
                    <div class="stat-details">
                        <h3 class="stat-value">{{ revenue_total|default:0|floatformat:2 }} د.م</h3>
                        <p class="stat-label">{% trans "إجمالي الإيرادات" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block admin_extra_css %}
<style>
    .stat-card {
        background: var(--bs-body-bg);
        border: 1px solid var(--bs-border-color);
        border-radius: 12px;
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        transition: all 0.3s ease;
        height: 100%;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        flex-shrink: 0;
    }

    .stat-primary .stat-icon {
        background: linear-gradient(135deg, #4b315e, #6b4c7a);
        color: white;
    }

    .stat-success .stat-icon {
        background: linear-gradient(135deg, #28a745, #20c997);
        color: white;
    }

    .stat-info .stat-icon {
        background: linear-gradient(135deg, #17a2b8, #138496);
        color: white;
    }

    .stat-warning .stat-icon {
        background: linear-gradient(135deg, #ffc107, #ff9800);
        color: white;
    }

    .stat-danger .stat-icon {
        background: linear-gradient(135deg, #dc3545, #c82333);
        color: white;
    }

    .stat-secondary .stat-icon {
        background: linear-gradient(135deg, #6c757d, #5a6268);
        color: white;
    }

    .stat-details {
        flex: 1;
    }

    .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        margin: 0;
        color: var(--bs-body-color);
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--bs-secondary-color);
        margin: 0;
    }

    .card-header {
        background: linear-gradient(135deg, #4b315e, #6b4c7a);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px 12px 0 0;
    }

    .card-body {
        padding: 1.5rem;
    }

    .table th {
        background: var(--bs-tertiary-bg);
        font-weight: 600;
        color: var(--bs-body-color);
        border: none;
    }

    .progress {
        background: var(--bs-tertiary-bg);
    }

    .progress-bar {
        background: linear-gradient(135deg, #4b315e, #6b4c7a);
    }

    [data-theme='dark'] .stat-card {
        background: #2d2d2d;
        border-color: #444;
    }

    [data-theme='dark'] .stat-card:hover {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    /* Responsive Adjustments */
    @media (max-width: 575.98px) {
        .stat-value {
            font-size: 1.5rem;
        }

        .stat-label {
            font-size: 0.75rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
        }

        .stat-card {
            padding: 0.75rem;
            gap: 0.75rem;
        }

        .admin-title {
            font-size: 1.5rem;
        }

        .admin-subtitle {
            font-size: 0.875rem;
        }

        .card-header {
            padding: 0.75rem 1rem;
        }

        .card-body {
            padding: 1rem;
        }
    }

    @media (min-width: 576px) and (max-width: 767.98px) {
        .stat-value {
            font-size: 1.625rem;
        }

        .stat-icon {
            width: 55px;
            height: 55px;
            font-size: 1.625rem;
        }
    }

    @media (max-width: 767.98px) {
        .admin-header-content {
            flex-direction: column;
            gap: 1rem;
        }

        .admin-header-actions {
            width: 100%;
        }

        .admin-header-actions .btn {
            width: 100%;
        }
    }

    @media print {
        .admin-header-actions,
        .sidebar,
        .navbar {
            display: none !important;
        }

        .stat-card {
            break-inside: avoid;
        }
    }
</style>
{% endblock %}
