{% extends 'admin_dashboard/base.html' %}
{% load static i18n %}

{% block title %}{% trans "إدارة الترجمة" %} - {{ block.super }}{% endblock %}

{% block admin_extra_css %}
<style>
    .translations-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        border-radius: 16px;
        margin-bottom: 30px;
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    [data-theme='dark'] .translations-header {
        background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    .translation-card {
        background: var(--bg-primary, white);
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid transparent;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    [data-theme='dark'] .translation-card {
        background: var(--bg-secondary, #1a1a1a);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .translation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    [data-theme='dark'] .translation-card:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
    }

    .language-badge {
        display: inline-flex;
        align-items: center;
        padding: 8px 16px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 0.9rem;
        gap: 8px;
    }

    .language-badge.ar {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }

    .language-badge.en {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-box {
        background: var(--bg-primary, white);
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        border: 1px solid transparent;
    }

    [data-theme='dark'] .stat-box {
        background: var(--bg-secondary, #1a1a1a);
        border-color: rgba(255, 255, 255, 0.1);
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .stat-number {
        font-size: 2rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    [data-theme='dark'] .stat-number {
        background: linear-gradient(135deg, #a5b4fc, #c4b5fd);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stat-label {
        color: var(--text-secondary, #6b7280);
        font-size: 0.9rem;
        margin-top: 8px;
    }

    [data-theme='dark'] .stat-label {
        color: #d1d5db;
    }

    .action-button {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
    }

    .action-button.primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .action-button.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        color: white;
    }

    .action-button.secondary {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
    }

    .action-button.secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        color: white;
    }

    .info-box {
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));
        border-left: 4px solid #3b82f6;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    [data-theme='dark'] .info-box {
        background: linear-gradient(135deg, rgba(96, 165, 250, 0.15), rgba(59, 130, 246, 0.1));
        border-left-color: #60a5fa;
    }

    .feature-list {
        list-style: none;
        padding: 0;
    }

    .feature-list li {
        padding: 10px 0;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        gap: 12px;
    }

    [data-theme='dark'] .feature-list li {
        border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .feature-list li:last-child {
        border-bottom: none;
    }

    .feature-list li i {
        color: #10b981;
        font-size: 1.1rem;
    }

    [data-theme='dark'] .feature-list li i {
        color: #34d399;
    }

    .rosetta-iframe-container {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10200;
        padding: 20px;
    }

    .rosetta-iframe-wrapper {
        width: 100%;
        height: 100%;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    [data-theme='dark'] .rosetta-iframe-wrapper {
        background: #1a1a1a;
    }

    .rosetta-iframe-header {
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    [data-theme='dark'] .rosetta-iframe-header {
        background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
    }

    .rosetta-close-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .rosetta-close-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(90deg);
    }

    .rosetta-iframe {
        flex: 1;
        border: none;
        background: white;
    }

    [data-theme='dark'] .rosetta-iframe {
        background: #1a1a1a;
    }
</style>
{% endblock %}

{% block admin_content %}
    <!-- Header -->
    <div class="translations-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="mb-2">
                    <i class="fas fa-language me-3"></i>
                    {% trans "إدارة الترجمة" %}
                </h1>
                <p class="mb-0 opacity-75">{% trans "إدارة ترجمات الموقع باستخدام Django Rosetta" %}</p>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-number">2</div>
            <div class="stat-label">{% trans "اللغات المتاحة" %}</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="totalStrings">-</div>
            <div class="stat-label">{% trans "إجمالي النصوص" %}</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="translatedStrings">-</div>
            <div class="stat-label">{% trans "النصوص المترجمة" %}</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="completionRate">-%</div>
            <div class="stat-label">{% trans "نسبة الإكمال" %}</div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="info-box">
        <h5>
            <i class="fas fa-info-circle me-2"></i>
            {% trans "حول نظام الترجمة" %}
        </h5>
        <p class="mb-0">
            {% trans "يستخدم الموقع Django Rosetta لإدارة الترجمات. يمكنك ترجمة جميع النصوص الظاهرة في الموقع من خلال واجهة سهلة الاستخدام." %}
        </p>
    </div>

    <!-- Language Cards -->
    <div class="row">
        <div class="col-md-6 mb-4">
            <div class="translation-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                        <span class="language-badge ar">
                            <i class="fas fa-flag"></i>
                            العربية
                        </span>
                    </h4>
                </div>
                <ul class="feature-list mb-4">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>{% trans "اللغة الافتراضية للموقع" %}</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>{% trans "دعم كامل من اليمين إلى اليسار (RTL)" %}</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>{% trans "جميع النصوص متوفرة" %}</span>
                    </li>
                </ul>
                <div class="d-flex gap-2">
                    <button onclick="openRosetta('/rosetta/pick/')" class="action-button primary">
                        <i class="fas fa-edit"></i>
                        {% trans "تحرير الترجمات" %}
                    </button>
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="translation-card">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="mb-0">
                        <span class="language-badge en">
                            <i class="fas fa-flag"></i>
                            English
                        </span>
                    </h4>
                </div>
                <ul class="feature-list mb-4">
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>{% trans "اللغة الثانوية" %}</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>{% trans "دعم من اليسار إلى اليمين (LTR)" %}</span>
                    </li>
                    <li>
                        <i class="fas fa-check-circle"></i>
                        <span>{% trans "يمكن تحديث الترجمات" %}</span>
                    </li>
                </ul>
                <div class="d-flex gap-2">
                    <button onclick="openRosetta('/rosetta/pick/')" class="action-button primary">
                        <i class="fas fa-edit"></i>
                        {% trans "تحرير الترجمات" %}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Tools -->
    <div class="translation-card">
        <h4 class="mb-4">
            <i class="fas fa-tools me-2"></i>
            {% trans "أدوات الترجمة" %}
        </h4>
        <div class="row">
            <div class="col-md-4 mb-3">
                <div class="d-flex flex-column gap-2">
                    <h6>{% trans "إدارة الترجمات" %}</h6>
                    <button onclick="openRosetta('/rosetta/')" class="action-button secondary">
                        <i class="fas fa-language"></i>
                        {% trans "فتح واجهة Rosetta" %}
                    </button>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="d-flex flex-column gap-2">
                    <h6>{% trans "تحديث ملفات الترجمة" %}</h6>
                    <button class="action-button secondary" onclick="updateTranslations()">
                        <i class="fas fa-sync"></i>
                        {% trans "تحديث الترجمات" %}
                    </button>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="d-flex flex-column gap-2">
                    <h6>{% trans "ترجمة تلقائية" %}</h6>
                    <button class="action-button secondary" onclick="showAutoTranslateInfo()">
                        <i class="fas fa-magic"></i>
                        {% trans "معلومات الترجمة التلقائية" %}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="translation-card">
        <h4 class="mb-3">
            <i class="fas fa-book me-2"></i>
            {% trans "دليل الاستخدام" %}
        </h4>
        <div class="row">
            <div class="col-md-6">
                <h6>{% trans "كيفية ترجمة النصوص:" %}</h6>
                <ol>
                    <li>{% trans "انقر على زر 'تحرير الترجمات' للغة المطلوبة" %}</li>
                    <li>{% trans "اختر الملف الذي تريد ترجمته (django.po أو djangojs.po)" %}</li>
                    <li>{% trans "ابحث عن النص الذي تريد ترجمته" %}</li>
                    <li>{% trans "أدخل الترجمة في الحقل المخصص" %}</li>
                    <li>{% trans "احفظ التغييرات" %}</li>
                </ol>
            </div>
            <div class="col-md-6">
                <h6>{% trans "نصائح مهمة:" %}</h6>
                <ul>
                    <li>{% trans "تأكد من استخدام التنسيق الصحيح للمتغيرات (مثل %(name)s)" %}</li>
                    <li>{% trans "احفظ التغييرات بشكل متكرر لتجنب فقدان العمل" %}</li>
                    <li>{% trans "اختبر الترجمات على الموقع بعد الحفظ" %}</li>
                    <li>{% trans "استخدم البحث للعثور على نصوص محددة" %}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Rosetta Iframe Container -->
    <div id="rosettaIframeContainer" class="rosetta-iframe-container">
        <div class="rosetta-iframe-wrapper">
            <div class="rosetta-iframe-header">
                <h5 class="mb-0">
                    <i class="fas fa-language me-2"></i>
                    {% trans "واجهة إدارة الترجمات" %}
                </h5>
                <button class="rosetta-close-btn" onclick="closeRosetta()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <iframe id="rosettaIframe" class="rosetta-iframe"></iframe>
        </div>
    </div>
{% endblock %}

{% block admin_extra_js %}
<script>
    function openRosetta(url) {
        const container = document.getElementById('rosettaIframeContainer');
        const iframe = document.getElementById('rosettaIframe');

        iframe.src = url;
        container.style.display = 'block';

        // Prevent body scroll when iframe is open
        document.body.style.overflow = 'hidden';
    }

    function closeRosetta() {
        const container = document.getElementById('rosettaIframeContainer');
        const iframe = document.getElementById('rosettaIframe');

        container.style.display = 'none';
        iframe.src = '';

        // Restore body scroll
        document.body.style.overflow = '';
    }

    // Close iframe on ESC key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeRosetta();
        }
    });

    function updateTranslations() {
        if (confirm('{% trans "هل تريد تحديث ملفات الترجمة؟ قد يستغرق هذا بعض الوقت." %}')) {
            // Show loading notification
            showNotification('{% trans "جاري تحديث الترجمات..." %}', 'info');

            // In production, this would make an AJAX call to compile translations
            setTimeout(() => {
                showNotification('{% trans "تم تحديث الترجمات بنجاح" %}', 'success');
            }, 2000);
        }
    }

    function showAutoTranslateInfo() {
        alert('{% trans "الترجمة التلقائية متاحة من خلال واجهة Rosetta. يمكنك استخدام خدمات الترجمة الآلية لترجمة النصوص تلقائياً، ثم مراجعتها وتحسينها يدوياً." %}');
    }

    // Toast notification (already defined in base, but adding fallback)
    if (typeof showNotification !== 'function') {
        window.showNotification = function(message, type = 'success') {
            const notification = document.createElement('div');
            const typeClass = type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info';
            const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle';
            notification.className = `alert alert-${typeClass} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 10800; min-width: 300px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${icon} me-2"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        };
    }

    // Simulate loading translation stats
    document.addEventListener('DOMContentLoaded', function() {
        // Simulate API call to get translation stats
        setTimeout(() => {
            document.getElementById('totalStrings').textContent = '1,234';
            document.getElementById('translatedStrings').textContent = '1,180';
            document.getElementById('completionRate').textContent = '95%';
        }, 500);
    });
</script>
{% endblock %}
