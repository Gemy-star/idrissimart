{% extends 'admin_dashboard/base.html' %}
{% load static i18n compress %}

{% block title %}
    {% trans "إعدادات النظام - لوحة تحكم المدير" %}
{% endblock title %}

{% block admin_extra_css %}
<style>
    .settings-group {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #e9ecef;
    }
    [data-theme='dark'] .settings-group {
        border-bottom-color: rgba(255, 255, 255, 0.1);
    }
    .settings-group:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    .settings-group-title {
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 1rem;
        font-size: 1.1rem;
    }
    [data-theme='dark'] .settings-group-title {
        color: #e9ecef;
    }
    .form-check-label strong {
        color: #2c3e50;
    }
    [data-theme='dark'] .form-check-label strong {
        color: #e9ecef;
    }
</style>
{% endblock %}

{% block admin_content %}
    <!-- Header -->
    <div class="admin-dashboard-header">
        <div class="row align-items-center">
            <div class="col">
                <h1 class="display-6 mb-1">
                    <i class="fas fa-cogs me-3"></i>
                    {% trans "إعدادات النظام" %}
                </h1>
                <p class="text-muted mb-0">{% trans "إدارة إعدادات النشر، التوصيل، والسلة الإلكترونية" %}</p>
            </div>
        </div>
    </div>

    <!-- Publishing Settings -->
    <div class="admin-content-card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-eye me-2"></i>
                {% trans "إعدادات النشر والعرض" %}
            </h5>
        </div>
        <div class="card-body">
            <form id="publishingSettingsForm">
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "وضع النشر" %}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input type="radio" name="publishing_mode" value="direct" class="form-check-input" id="directPublish" checked>
                                <label class="form-check-label" for="directPublish">
                                    <strong>{% trans "النشر المباشر" %}</strong>
                                    <small class="d-block text-muted">{% trans "الإعلانات تظهر فوراً بدون مراجعة" %}</small>
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input type="radio" name="publishing_mode" value="review" class="form-check-input" id="reviewPublish">
                                <label class="form-check-label" for="reviewPublish">
                                    <strong>{% trans "النشر بعد المراجعة" %}</strong>
                                    <small class="d-block text-muted">{% trans "الإعلانات تحتاج موافقة المدير" %}</small>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "استثناء المستخدمين الموثقين" %}</h6>
                    <div class="form-check form-switch">
                        <input type="checkbox" name="verified_auto_publish" class="form-check-input" id="verifiedAutoPublish" checked>
                        <label class="form-check-label" for="verifiedAutoPublish">
                            {% trans "نشر إعلانات المستخدمين الموثقين مباشرة (حتى في وضع المراجعة)" %}
                        </label>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "إعدادات الزوار" %}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input type="checkbox" name="allow_guest_viewing" class="form-check-input" id="allowGuestViewing" checked>
                                <label class="form-check-label" for="allowGuestViewing">
                                    {% trans "السماح للزوار بمشاهدة الإعلانات" %}
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check form-switch">
                                <input type="checkbox" name="allow_guest_contact" class="form-check-input" id="allowGuestContact">
                                <label class="form-check-label" for="allowGuestContact">
                                    {% trans "السماح للزوار برؤية معلومات الاتصال" %}
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "ميزات الأعضاء المسجلين فقط" %}</h6>
                    <div class="form-check form-switch mb-2">
                        <input type="checkbox" name="members_only_contact" class="form-check-input" id="membersOnlyContact" checked>
                        <label class="form-check-label" for="membersOnlyContact">
                            {% trans "إظهار معلومات الاتصال للأعضاء المسجلين فقط" %}
                        </label>
                    </div>
                    <div class="form-check form-switch">
                        <input type="checkbox" name="members_only_messaging" class="form-check-input" id="membersOnlyMessaging" checked>
                        <label class="form-check-label" for="membersOnlyMessaging">
                            {% trans "إرسال الرسائل للأعضاء المسجلين فقط" %}
                        </label>
                    </div>
                </div>
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>
                        {% trans "حفظ إعدادات النشر" %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delivery Settings -->
    <div class="admin-content-card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-truck me-2"></i>
                {% trans "إعدادات التوصيل والتحصيل" %}
            </h5>
        </div>
        <div class="card-body">
            <form id="deliverySettingsForm">
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "تفعيل خدمة التوصيل والتحصيل" %}</h6>
                    <div class="form-check form-switch">
                        <input type="checkbox" name="delivery_service_enabled" class="form-check-input" id="deliveryServiceEnabled" checked>
                        <label class="form-check-label" for="deliveryServiceEnabled">
                            {% trans "تفعيل خدمة التوصيل والتحصيل للمستخدمين" %}
                        </label>
                    </div>
                    <small class="form-text text-muted">
                        {% trans "عند تفعيل هذه الخدمة، يمكن للمستخدمين اختيار التوصيل والتحصيل لإعلاناتهم" %}
                    </small>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "موافقة المدير" %}</h6>
                    <div class="form-check form-switch">
                        <input type="checkbox" name="delivery_requires_approval" class="form-check-input" id="deliveryRequiresApproval" checked>
                        <label class="form-check-label" for="deliveryRequiresApproval">
                            {% trans "تتطلب الإعلانات مع التوصيل والتحصيل موافقة المدير قبل تفعيل السلة" %}
                        </label>
                    </div>
                    <small class="form-text text-muted">
                        {% trans "يجب على المدير الاتفاق مع المستخدم على قيمة الخدمة قبل تفعيل السلة" %}
                    </small>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "شروط وأحكام التوصيل والتحصيل" %}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">{% trans "الشروط باللغة العربية" %}</label>
                            <textarea name="delivery_terms_ar" class="form-control" rows="4" placeholder="{% trans 'شروط وأحكام خدمة التوصيل والتحصيل...' %}">{% if delivery_terms %}{{ delivery_terms.arabic }}{% endif %}</textarea>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">{% trans "الشروط باللغة الإنجليزية" %}</label>
                            <textarea name="delivery_terms_en" class="form-control" rows="4" placeholder="Delivery and collection service terms...">{{ delivery_terms.english }}</textarea>
                        </div>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "رسوم الخدمة" %}</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">{% trans "نسبة رسوم الخدمة (%)" %}</label>
                            <input type="number" name="delivery_fee_percentage" class="form-control" min="0" max="100" step="0.1" value="5">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">{% trans "الحد الأدنى للرسوم" %}</label>
                            <input type="number" name="delivery_fee_min" class="form-control" min="0" step="1" value="10">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">{% trans "الحد الأقصى للرسوم" %}</label>
                            <input type="number" name="delivery_fee_max" class="form-control" min="0" step="1" value="500">
                        </div>
                    </div>
                </div>
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>
                        {% trans "حفظ إعدادات التوصيل" %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cart Settings -->
    <div class="admin-content-card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-shopping-cart me-2"></i>
                {% trans "إعدادات السلة الإلكترونية" %}
            </h5>
        </div>
        <div class="card-body">
            <form id="cartSettingsForm">
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "تفعيل نظام السلة" %}</h6>
                    <div class="form-check form-switch">
                        <input type="checkbox" name="cart_system_enabled" class="form-check-input" id="cartSystemEnabled" checked>
                        <label class="form-check-label" for="cartSystemEnabled">
                            {% trans "تفعيل نظام السلة الإلكترونية" %}
                        </label>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "مستويات تفعيل السلة" %}</h6>
                    <div class="form-check mb-2">
                        <input type="checkbox" name="cart_by_main_category" class="form-check-input" id="cartByMainCategory">
                        <label class="form-check-label" for="cartByMainCategory">
                            {% trans "تفعيل السلة على مستوى الأقسام الرئيسية" %}
                        </label>
                    </div>
                    <div class="form-check mb-2">
                        <input type="checkbox" name="cart_by_subcategory" class="form-check-input" id="cartBySubcategory" checked>
                        <label class="form-check-label" for="cartBySubcategory">
                            {% trans "تفعيل السلة على مستوى الأقسام الفرعية" %}
                        </label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" name="cart_per_ad" class="form-check-input" id="cartPerAd" checked>
                        <label class="form-check-label" for="cartPerAd">
                            {% trans "تفعيل السلة على مستوى الإعلان الواحد" %}
                        </label>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "هيكل الدفعات" %}</h6>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        {% trans "السعر الإجمالي = سعر المنتج + قيمة الحجز" %}<br>
                        {% trans "المبلغ المطلوب دفعه = قيمة الحجز فقط (ليس السعر الكامل)" %}
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">{% trans "نسبة الحجز الافتراضية (%)" %}</label>
                            <input type="number" name="default_reservation_percentage" class="form-control" min="0" max="100" step="1" value="20">
                            <small class="form-text text-muted">{% trans "نسبة من السعر الإجمالي" %}</small>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">{% trans "الحد الأدنى للحجز" %}</label>
                            <input type="number" name="min_reservation_amount" class="form-control" min="0" step="1" value="50">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">{% trans "الحد الأقصى للحجز" %}</label>
                            <input type="number" name="max_reservation_amount" class="form-control" min="0" step="1" value="5000">
                        </div>
                    </div>
                </div>
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>
                        {% trans "حفظ إعدادات السلة" %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notifications -->
    <div class="admin-content-card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-bell me-2"></i>
                {% trans "إعدادات الإشعارات" %}
            </h5>
        </div>
        <div class="card-body">
            <form id="notificationsSettingsForm">
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "إشعارات المدير" %}</h6>
                    <div class="form-check form-switch mb-2">
                        <input type="checkbox" name="notify_admin_new_ads" class="form-check-input" id="notifyAdminNewAds" checked>
                        <label class="form-check-label" for="notifyAdminNewAds">
                            {% trans "إشعار بالإعلانات الجديدة" %}
                        </label>
                    </div>
                    <div class="form-check form-switch mb-2">
                        <input type="checkbox" name="notify_admin_pending_review" class="form-check-input" id="notifyAdminPendingReview" checked>
                        <label class="form-check-label" for="notifyAdminPendingReview">
                            {% trans "إشعار بالإعلانات قيد المراجعة" %}
                        </label>
                    </div>
                    <div class="form-check form-switch mb-2">
                        <input type="checkbox" name="notify_admin_new_users" class="form-check-input" id="notifyAdminNewUsers" checked>
                        <label class="form-check-label" for="notifyAdminNewUsers">
                            {% trans "إشعار بالمستخدمين الجدد" %}
                        </label>
                    </div>
                    <div class="form-check form-switch">
                        <input type="checkbox" name="notify_admin_payments" class="form-check-input" id="notifyAdminPayments" checked>
                        <label class="form-check-label" for="notifyAdminPayments">
                            {% trans "إشعار بالمدفوعات الجديدة" %}
                        </label>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "إعدادات الإيميل" %}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">{% trans "إيميل المدير للإشعارات" %}</label>
                            <input type="email" name="admin_notification_email" class="form-control" value="{{ user.email }}">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">{% trans "اسم الموقع في الإيميلات" %}</label>
                            <input type="text" name="site_name_in_emails" class="form-control" value="إدريسي مارت">
                        </div>
                    </div>
                </div>
                <div class="settings-group">
                    <h6 class="settings-group-title">{% trans "تكرار الإشعارات" %}</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">{% trans "تجميع إشعارات الإعلانات" %}</label>
                            <select name="ads_notification_frequency" class="form-select">
                                <option value="instant">{% trans "فوري" %}</option>
                                <option value="hourly" selected>{% trans "كل ساعة" %}</option>
                                <option value="daily">{% trans "يومي" %}</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">{% trans "تقرير الإحصائيات" %}</label>
                            <select name="stats_report_frequency" class="form-select">
                                <option value="daily" selected>{% trans "يومي" %}</option>
                                <option value="weekly">{% trans "أسبوعي" %}</option>
                                <option value="monthly">{% trans "شهري" %}</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>
                        {% trans "حفظ إعدادات الإشعارات" %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Constance Settings -->
    <div class="admin-content-card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-sliders-h me-2"></i>
                {% trans "إعدادات django-constance" %}
            </h5>
            <button id="saveConstanceBtn" type="button" class="btn btn-primary btn-sm" onclick="saveConstanceSettings()">
                <i class="fas fa-save me-1"></i>
                {% trans "حفظ الإعدادات" %}
            </button>
        </div>
        <div class="card-body">
            <div id="constanceSettingsList" class="row g-3">
                <!-- populated dynamically -->
            </div>
        </div>
    </div>

    {{ system_settings|json_script:"system-settings-data" }}
{% endblock %}

{% block admin_extra_js %}
<script>
// URL patterns with language prefix
const SETTINGS_URLS = {
    publishing: '{% url "main:admin_settings_publishing" %}',
    delivery: '{% url "main:admin_settings_delivery" %}',
    cart: '{% url "main:admin_settings_cart" %}',
    notifications: '{% url "main:admin_settings_notifications" %}'
};

document.addEventListener('DOMContentLoaded', function() {
    loadSystemSettings();
    loadConstanceSettings();

    const publishingForm = document.getElementById('publishingSettingsForm');
    const deliveryForm = document.getElementById('deliverySettingsForm');
    const cartForm = document.getElementById('cartSettingsForm');
    const notificationsForm = document.getElementById('notificationsSettingsForm');

    if (publishingForm) publishingForm.addEventListener('submit', savePublishingSettings);
    if (deliveryForm) deliveryForm.addEventListener('submit', saveDeliverySettings);
    if (cartForm) cartForm.addEventListener('submit', saveCartSettings);
    if (notificationsForm) notificationsForm.addEventListener('submit', saveNotificationSettings);
});

function loadSystemSettings() {
    fetch('{% url "main:admin_settings_get" %}', {
        method: 'POST',
        headers: { 'X-CSRFToken': getCookie('csrftoken') }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text();
    })
    .then(text => {
        if (!text || text.trim() === '') {
            console.warn('Empty response from system settings API');
            return;
        }
        const data = JSON.parse(text);
        if (data.success && data.settings) {
            populateSettingsForms(data.settings);
        }
    })
    .catch(error => console.error('Error loading settings:', error));
}

function populateSettingsForms(settings) {
    if (settings.publishing_mode) {
        const radio = document.querySelector(`input[name="publishing_mode"][value="${settings.publishing_mode}"]`);
        if (radio) radio.checked = true;
    }
    const checkboxes = {
        'verified_auto_publish': 'verifiedAutoPublish',
        'allow_guest_viewing': 'allowGuestViewing',
        'allow_guest_contact': 'allowGuestContact',
        'members_only_contact': 'membersOnlyContact',
        'members_only_messaging': 'membersOnlyMessaging',
        'delivery_service_enabled': 'deliveryServiceEnabled',
        'delivery_requires_approval': 'deliveryRequiresApproval',
        'cart_system_enabled': 'cartSystemEnabled',
        'cart_by_main_category': 'cartByMainCategory',
        'cart_by_subcategory': 'cartBySubcategory',
        'cart_per_ad': 'cartPerAd',
        'notify_admin_new_ads': 'notifyAdminNewAds',
        'notify_admin_pending_review': 'notifyAdminPendingReview',
        'notify_admin_new_users': 'notifyAdminNewUsers',
        'notify_admin_payments': 'notifyAdminPayments'
    };
    for (const [key, elementId] of Object.entries(checkboxes)) {
        if (settings[key] !== undefined) {
            const checkbox = document.getElementById(elementId);
            if (checkbox) checkbox.checked = settings[key];
        }
    }
}

function savePublishingSettings(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    fetch(SETTINGS_URLS.publishing, {
        method: 'POST',
        headers: { 'X-CSRFToken': getCookie('csrftoken') },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) showSuccess('تم حفظ إعدادات النشر بنجاح');
        else showError('فشل في حفظ الإعدادات');
    });
}

function saveDeliverySettings(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    fetch(SETTINGS_URLS.delivery, {
        method: 'POST',
        headers: { 'X-CSRFToken': getCookie('csrftoken') },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) showSuccess('تم حفظ إعدادات التوصيل بنجاح');
        else showError('فشل في حفظ الإعدادات');
    });
}

function saveCartSettings(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    fetch(SETTINGS_URLS.cart, {
        method: 'POST',
        headers: { 'X-CSRFToken': getCookie('csrftoken') },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) showSuccess('تم حفظ إعدادات السلة بنجاح');
        else showError('فشل في حفظ الإعدادات');
    });
}

function saveNotificationSettings(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    fetch(SETTINGS_URLS.notifications, {
        method: 'POST',
        headers: { 'X-CSRFToken': getCookie('csrftoken') },
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) showSuccess('تم حفظ إعدادات الإشعارات بنجاح');
        else showError('فشل في حفظ الإعدادات');
    });
}

function loadConstanceSettings() {
    fetch('{% url "main:admin_settings_constance_get" %}', {
        method: 'POST',
        headers: { 'X-CSRFToken': getCookie('csrftoken') }
    })
    .then(r => {
        if (!r.ok) {
            throw new Error('Network response was not ok');
        }
        return r.text();
    })
    .then(text => {
        if (!text || text.trim() === '') {
            console.warn('Empty response from constance settings API');
            return;
        }
        const data = JSON.parse(text);
        if (!data.success) {
            console.warn('Constance settings API returned success=false');
            return;
        }
        const container = document.getElementById('constanceSettingsList');
        if (!container) return;
        container.innerHTML = '';
        if (!data.config || !Array.isArray(data.config)) {
            console.warn('No config array in constance settings response');
            return;
        }
        data.config.forEach(item => {
            const id = `const_${item.key}`;
            const type = (item.type || '').toLowerCase();
            let control = '';
            if (type === 'bool' || type === 'boolean') {
                control = `<div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="${id}" data-key="${item.key}" ${item.value ? 'checked' : ''}>
                    <label class="form-check-label" for="${id}"><strong>${item.key}</strong><br><small class="text-muted">${item.help || ''}</small></label>
                </div>`;
            } else if (type === 'int' || type === 'float' || type === 'decimal') {
                const step = (type === 'int') ? '1' : '0.01';
                control = `<label class="form-label" for="${id}"><strong>${item.key}</strong></label>
                    <input class="form-control" type="number" step="${step}" id="${id}" data-key="${item.key}" value="${item.value}">
                    <small class="text-muted">${item.help || ''}</small>`;
            } else {
                control = `<label class="form-label" for="${id}"><strong>${item.key}</strong></label>
                    <input class="form-control" type="text" id="${id}" data-key="${item.key}" value="${item.value ?? ''}">
                    <small class="text-muted">${item.help || ''}</small>`;
            }
            const col = document.createElement('div');
            col.className = 'col-md-6';
            col.innerHTML = `<div class="constance-item">${control}</div>`;
            container.appendChild(col);
        });
    })
    .catch(error => {
        console.error('Error loading constance settings:', error);
    });
}

function saveConstanceSettings() {
    const container = document.getElementById('constanceSettingsList');
    if (!container) return;
    const inputs = container.querySelectorAll('[data-key]');
    const updates = {};
    inputs.forEach(el => {
        const key = el.getAttribute('data-key');
        updates[key] = (el.type === 'checkbox') ? el.checked : el.value;
    });
    fetch('{% url "main:admin_settings_constance_save" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({ updates })
    })
    .then(r => r.json())
    .then(data => {
        if (data.success) showSuccess('تم حفظ إعدادات النظام');
        else showError(data.message || 'حدث خطأ أثناء الحفظ');
    })
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function showSuccess(message) {
    showToast(message, 'success');
}

function showError(message) {
    showToast('خطأ: ' + message, 'error');
}
</script>
{% endblock admin_extra_js %}
