{% extends "base.html" %}

{% load static i18n %}

{% block title %}
    {% trans "الرئيسية" %} - {% trans "إدريسي مارت" %}

{% endblock title %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/blog.css' %}">

{% endblock %}

{% block content %}
    <!-- Hero Section -->
    <section class="hero-section" id="home">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 hero-content">
                    <h1 class="hero-title">{% trans "منصة تجمع سوق واحد متكامل" %}</h1>
                    <p class="hero-subtitle">
                        {% trans "منصة تجمع سوق واحد متخصص يستفيد منه المتخصصون والجمهور العام الذي يحتاج إلى أيٍ من خدمات هذا السوق" %}
                    </p>
                    <a href="{% url 'main:categories' %}"
                       class="btn btn-custom btn-secondary-custom btn-hero me-3">
                        <i class="fas fa-store me-2"></i>{% trans "استكشف أقسام المنصة" %}
                    </a>
                    <a href="{% url 'main:contact' %}"
                       class="btn btn-custom btn-secondary-custom btn-hero me-3">
                        <i class="fas fa-handshake me-2"></i>{% trans "تواصل مع فريقنا" %}
                    </a>
                </div>
                <div class="col-lg-6 mt-5 mt-lg-0">
                    <img src="https://images.unsplash.com/photo-1545239351-1141bd82e8a6?w=600&h=500&fit=crop"
                         alt="Unified marketplace"
                         width="600"
                         height="500"
                         class="img-fluid rounded-4 shadow-lg"
                         id="heroImage" />
                </div>
            </div>
        </div>
    </section>
    <!-- Swiper Section -->
    <section class="swiper-section" id="featured">
        <div class="container">
            <h2 class="section-title">{% trans "الإعلانات المميزة" %}</h2>
            <div class="swiper idrisiMartFeaturedSwiper">
                <div class="swiper-wrapper">
                    {% for ad in featured_ads %}
                        <div class="swiper-slide">
                            {% include "pages/_ad_card.html" with ad=ad %}

                        </div>
                    {% empty %}
                        <div class="swiper-slide">
                            <p class="text-center text-muted">{% trans "لا توجد إعلانات مميزة حالياً." %}</p>
                        </div>
                    {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </section>
    <!-- Features Section -->
    <section class="features-section" id="about">
        <div class="container">
            <h2 class="section-title text-white">{% trans "لماذا إدريسي مارت للمساحة؟" %}</h2>
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-crosshairs"></i>
                        </div>
                        <h4 class="feature-title">{% trans "دقة عالية" %}</h4>
                        <p>{% trans "نضمن أعلى معايير الدقة في جميع أعمال المساحة والقياس" %}</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-satellite"></i>
                        </div>
                        <h4 class="feature-title">{% trans "تقنية متطورة" %}</h4>
                        <p>{% trans "نستخدم أحدث أجهزة المساحة والتقنيات الجيوديسية" %}</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-certificate"></i>
                        </div>
                        <h4 class="feature-title">{% trans "خبرة معتمدة" %}</h4>
                        <p>{% trans "فريق من المهندسين المساحين المعتمدين وذوي الخبرة" %}</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="feature-box">
                        <div class="feature-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <h4 class="feature-title">{% trans "تسليم سريع" %}</h4>
                        <p>{% trans "التزام بالمواعيد المحددة وتسليم المشاريع في الوقت" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Latest Ads Section -->
    <section class="latest-ads-section py-5">
        <div class="container">
            <h2 class="section-title">{% trans "أحدث الإعلانات" %}</h2>
            <div class="swiper idrisiMartLatestSwiper">
                <div class="swiper-wrapper">
                    {% for ad in latest_ads %}
                        <div class="swiper-slide">
                            {% include "pages/_ad_card.html" with ad=ad %}

                        </div>
                    {% empty %}
                        <div class="swiper-slide">
                            <p class="text-center text-muted">{% trans "لا توجد إعلانات جديدة حالياً." %}</p>
                        </div>
                    {% endfor %}
                </div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </section>
    <!-- Stats Section -->
    <section class="stats-section py-5">
        <div class="container">
            <div class="row text-center g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="stat-box">
                        <i class="fas fa-map fa-3x mb-3 text-secondary-color"></i>
                        <h3 class="stat-number" data-target="250">0</h3>
                        <p class="stat-label">{% trans "مشروع مساحي منجز" %}</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stat-box">
                        <i class="fas fa-drafting-compass fa-3x mb-3 text-secondary-color"></i>
                        <h3 class="stat-number" data-target="500">0</h3>
                        <p class="stat-label">{% trans "خريطة مساحية" %}</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stat-box">
                        <i class="fas fa-users fa-3x mb-3 text-secondary-color"></i>
                        <h3 class="stat-number" data-target="150">0</h3>
                        <p class="stat-label">{% trans "عميل راضٍ" %}</p>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="stat-box">
                        <i class="fas fa-award fa-3x mb-3 text-secondary-color"></i>
                        <h3 class="stat-number" data-target="15">0</h3>
                        <p class="stat-label">{% trans "سنة خبرة" %}</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Latest Blogs Section -->
    <section class="latest-blogs-section py-5">
        <div class="container">
            <div class="section-header text-center mb-5">
                <h2 class="section-title">{% trans "أحدث المقالات" %}</h2>
                <p class="section-subtitle">{% trans "اكتشف آخر ما نشرناه في المدونة" %}</p>
            </div>
            {% if latest_blogs %}
                <!-- Swiper Container -->
                <div class="swiper home-blogs-swiper">
                    <div class="swiper-wrapper">
                        {% for blog in latest_blogs %}
                            <div class="swiper-slide">
                                <div class="blog-post-card h-100 gsap-fade-up">
                                    <a href="{{ blog.get_absolute_url }}" class="card-img-container">
                                        {% if blog.image %}
                                            <img src="{{ blog.image.url }}"
                                                 class="card-img-top"
                                                 alt="{{ blog.title }}">
                                        {% else %}
                                            <img src="https://via.placeholder.com/400x250"
                                                 class="card-img-top"
                                                 alt="Placeholder">
                                        {% endif %}
                                    </a>
                                    <div class="card-body d-flex flex-column">
                                        <div class="mb-2">
                                            {% for tag in blog.tags.all|slice:":2" %}
                                                <a href="{% url 'content:blog_list_by_tag' tag.slug %}" class="blog-tag">
                                                    <i class="fas fa-tag me-1"></i>{{ tag.name }}
                                                </a>
                                            {% endfor %}
                                        </div>
                                        <h5 class="card-title">
                                            <a href="{{ blog.get_absolute_url }}">{{ blog.title }}</a>
                                        </h5>
                                        <p class="card-text flex-grow-1">{{ blog.content|striptags|truncatewords:15 }}</p>
                                        <div class="card-footer bg-transparent border-0 p-0 mt-auto">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <div class="blog-author-info">
                                                    <small class="text-muted d-block"><i class="fas fa-user-edit me-1"></i> {{ blog.author.get_full_name|default:blog.author.username }}</small>
                                                    <small class="text-muted d-block"><i class="fas fa-calendar-alt me-1"></i> {{ blog.published_date|date:"Y-m-d" }}</small>
                                                </div>
                                                <a href="{{ blog.get_absolute_url }}"
                                                   class="btn btn-sm btn-outline-primary blog-read-more-btn">{% trans "اقرأ المزيد" %}</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    <!-- Swiper Navigation -->
                    <div class="swiper-button-next home-blogs-next"></div>
                    <div class="swiper-button-prev home-blogs-prev"></div>
                    <!-- Swiper Pagination -->
                    <div class="swiper-pagination home-blogs-pagination"></div>
                </div>
                <div class="text-center mt-5">
                    <a href="{% url 'content:blog_list' %}"
                       class="btn btn-primary btn-lg btn-post-ad">
                        <i class="fas fa-newspaper me-2"></i>{% trans "عرض جميع المقالات" %}
                    </a>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-newspaper fa-3x text-muted mb-3"></i>
                    <p class="text-muted">{% trans "لا توجد مقالات منشورة بعد." %}</p>
                </div>
            {% endif %}
        </div>
    </section>

{% endblock content %}

{% block extra_js %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Home Blogs Swiper
            const homeBlogsSwiper = document.querySelector('.home-blogs-swiper');
            if (homeBlogsSwiper) {
                new Swiper('.home-blogs-swiper', {
                    slidesPerView: 1,
                    spaceBetween: 20,
                    loop: true,
                    autoplay: {
                        delay: 5000,
                        disableOnInteraction: false,
                        pauseOnMouseEnter: true,
                    },
                    speed: 800,
                    navigation: {
                        nextEl: '.home-blogs-next',
                        prevEl: '.home-blogs-prev',
                    },
                    pagination: {
                        el: '.home-blogs-pagination',
                        clickable: true,
                    },
                    breakpoints: {
                        640: {
                            slidesPerView: 1,
                            spaceBetween: 20,
                        },
                        768: {
                            slidesPerView: 2,
                            spaceBetween: 25,
                        },
                        1024: {
                            slidesPerView: 3,
                            spaceBetween: 30,
                        }
                    }
                });
                console.log('✅ Home Blogs Swiper: Initialized');
            }

            // Tab functionality (scoped per tab group)
            document.querySelectorAll('.tab-buttons').forEach((btnContainer) => {
                const buttons = Array.from(btnContainer.querySelectorAll('.tab-btn'));
                // use nearest .container as the common root for buttons and panes
                const panesRoot = btnContainer.closest('.container') || document.body;
                const panes = panesRoot ? Array.from(panesRoot.querySelectorAll('.tab-pane')) : Array.from(document.querySelectorAll('.tab-pane'));

                function deactivateLocal() {
                    buttons.forEach(b => {
                        b.classList.remove('active');
                        b.setAttribute('aria-selected', 'false');
                    });
                    panes.forEach(p => p.classList.remove('active', 'show'));
                }

                const anyActiveLocal = buttons.some(b => b.classList.contains('active'));
                if (!anyActiveLocal && buttons.length) {
                    const defaultBtn = btnContainer.querySelector('#tab-btn-all') || buttons[0];
                    defaultBtn.classList.add('active');
                    defaultBtn.setAttribute('aria-selected', 'true');
                    const defaultTarget = defaultBtn.getAttribute('data-tab');
                    const el = defaultTarget ? panesRoot.querySelector('#' + defaultTarget) : null;
                    if (el) el.classList.add('active', 'show');
                }

                buttons.forEach((button) => {
                    button.addEventListener('click', function() {
                        const targetTab = this.getAttribute('data-tab');
                        if (!targetTab) return;
                        const targetEl = panesRoot.querySelector('#' + targetTab) || document.getElementById(targetTab);
                        if (!targetEl) return;

                        deactivateLocal();
                        this.classList.add('active');
                        this.setAttribute('aria-selected', 'true');
                        targetEl.classList.add('active', 'show');
                        this.focus();
                    });
                });
            });

            // Swiper initialization
            const idrisiMartSwiper = new Swiper('.idrisiMartFeaturedSwiper', {
                slidesPerView: 1,
                spaceBetween: 20,
                autoplay: {
                    delay: 3000,
                    disableOnInteraction: false,
                    pauseOnMouseEnter: true,
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                    dynamicBullets: true,
                },
                breakpoints: {
                    576: {
                        slidesPerView: 2,
                        spaceBetween: 20,
                    },
                    768: {
                        slidesPerView: 3,
                        spaceBetween: 25,
                    },
                    992: {
                        slidesPerView: 3,
                        spaceBetween: 30,
                    },
                    1200: {
                        slidesPerView: 3,
                        spaceBetween: 35,
                    },
                    1400: {
                        slidesPerView: 4,
                        spaceBetween: 40,
                    },
                },
                speed: 600,
                effect: 'slide',
                grabCursor: true,
                watchSlidesProgress: true,
                lazy: {
                    loadPrevNext: true,
                    loadOnTransitionStart: true,
                },
                on: {
                    init: function() {
                        console.log('🎨 Idrisi Mart Swiper Initialized')
                    },
                },
            })

            // Swiper initialization for Latest Ads
            const idrisiMartLatestSwiper = new Swiper('.idrisiMartLatestSwiper', {
                slidesPerView: 1,
                spaceBetween: 20,
                autoplay: {
                    delay: 3500, // Slightly different delay
                    disableOnInteraction: false,
                    pauseOnMouseEnter: true,
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                    dynamicBullets: true,
                },
                breakpoints: {
                    576: {
                        slidesPerView: 2,
                        spaceBetween: 20
                    },
                    768: {
                        slidesPerView: 2,
                        spaceBetween: 25
                    },
                    992: {
                        slidesPerView: 3,
                        spaceBetween: 30
                    },
                    1200: {
                        slidesPerView: 3,
                        spaceBetween: 35
                    },
                    1400: {
                        slidesPerView: 4,
                        spaceBetween: 40
                    },
                },
                speed: 600,
                effect: 'slide',
                grabCursor: true,
                watchSlidesProgress: true,
                lazy: {
                    loadPrevNext: true,
                    loadOnTransitionStart: true,
                },
                on: {
                    init: function() {
                        console.log('🎨 Idrisi Mart Latest Ads Swiper Initialized')
                    },
                },
            });
        })
    </script>

{% endblock extra_js %}
