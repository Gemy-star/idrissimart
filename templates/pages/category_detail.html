{% extends "base.html" %}

{% load static i18n %}

{% block title %}
    {% if category %}
        {% if LANGUAGE_CODE == 'ar' and category.name_ar %}
            {{ category.name_ar }}
        {% else %}
            {{ category.name }}
        {% endif %}
    {% else %}
        {% trans "القسم غير موجود" %}
    {% endif %}
    - {% trans "إدريسي مارت" %}
{% endblock title %}

{% block content %}
    {% if category %}
        <!-- Modern Category Hero Section -->
        <section class="modern-hero-section">
            <div class="hero-background-gradient"></div>
            <div class="container">
                <!-- Breadcrumb Navigation using Partial -->
                <div class="enhanced-breadcrumb mb-4">
                    {% include 'partials/_breadcrumbs.html' %}
                </div>

                <div class="hero-content-modern">
                    <div class="hero-icon-wrapper">
                        <i class="fas fa-{% if category.icon %}{{ category.icon }}{% else %}tag{% endif %} hero-icon"></i>
                    </div>
                    <h1 class="modern-hero-title">
                        {% if LANGUAGE_CODE == 'ar' and category.name_ar %}
                            {{ category.name_ar }}
                        {% else %}
                            {{ category.name }}
                        {% endif %}
                    </h1>
                    <p class="modern-hero-subtitle">
                        {% if LANGUAGE_CODE == 'ar' and category.description_ar %}
                            {{ category.description_ar }}
                        {% elif category.description %}
                            {{ category.description }}
                        {% else %}
                            {% trans "استكشف جميع الإعلانات في هذا القسم واعثر على ما تبحث عنه بسهولة" %}
                        {% endif %}
                    </p>

                    <!-- Enhanced Search and Filter Bar -->
                    <div class="hero-search-container">
                        <div class="search-filter-wrapper">
                            <!-- Search Input -->
                            <div class="search-input-group">
                                <div class="search-icon-wrapper">
                                    <i class="fas fa-search search-icon"></i>
                                </div>
                                <input type="text"
                                       id="categorySearchInput"
                                       class="form-control modern-search-input"
                                       placeholder="{% trans 'ابحث في إعلانات هذا القسم...' %}"
                                       autocomplete="off">
                                <button type="button" id="clearSearchBtn" class="clear-search-btn" style="display: none;">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <!-- Price Filter Group -->
                            <div class="price-filter-group">
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="fas fa-dollar-sign"></i>
                                    </span>
                                    <input type="number"
                                           id="minPrice"
                                           class="form-control"
                                           placeholder="{% trans 'الحد الأدنى' %}"
                                           min="0">
                                    <span class="input-group-text">-</span>
                                    <input type="number"
                                           id="maxPrice"
                                           class="form-control"
                                           placeholder="{% trans 'الحد الأقصى' %}"
                                           min="0">
                                </div>
                            </div>

                            <!-- Country Filter -->
                            <div class="location-filter-group">
                                <select class="form-control" id="countryFilter">
                                    <option value="">{% trans "جميع البلدان" %}</option>
                                    <option value="MA">{% trans "المغرب" %}</option>
                                    <option value="DZ">{% trans "الجزائر" %}</option>
                                    <option value="TN">{% trans "تونس" %}</option>
                                    <option value="EG">{% trans "مصر" %}</option>
                                    <option value="SA">{% trans "السعودية" %}</option>
                                    <option value="AE">{% trans "الإمارات" %}</option>
                                    <option value="KW">{% trans "الكويت" %}</option>
                                    <option value="QA">{% trans "قطر" %}</option>
                                    <option value="BH">{% trans "البحرين" %}</option>
                                    <option value="OM">{% trans "عمان" %}</option>
                                    <option value="JO">{% trans "الأردن" %}</option>
                                    <option value="LB">{% trans "لبنان" %}</option>
                                    <option value="SY">{% trans "سوريا" %}</option>
                                    <option value="IQ">{% trans "العراق" %}</option>
                                    <option value="LY">{% trans "ليبيا" %}</option>
                                    <option value="SD">{% trans "السودان" %}</option>
                                    <option value="YE">{% trans "اليمن" %}</option>
                                </select>
                            </div>

                            <!-- Advanced Filter Dropdown -->
                            <div class="filter-dropdown-container">
                                <button class="btn modern-filter-btn" type="button" id="filterDropdownBtn" data-bs-toggle="dropdown">
                                    <i class="fas fa-filter me-2"></i>
                                    <span class="filter-text">{% trans "فلترة متقدمة" %}</span>
                                    <i class="fas fa-chevron-down ms-2"></i>
                                </button>
                                <ul class="dropdown-menu modern-dropdown-menu">
                                    <!-- Sort Section -->
                                    <li>
                                        <h6 class="dropdown-header">
                                            <i class="fas fa-sort-amount-down me-2"></i>
                                            {% trans "ترتيب حسب" %}
                                        </h6>
                                    </li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="date">
                                        <i class="fas fa-calendar me-2"></i>{% trans "تاريخ النشر" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="price-low">
                                        <i class="fas fa-sort-amount-down me-2"></i>{% trans "السعر (أقل لأعلى)" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="price-high">
                                        <i class="fas fa-sort-amount-up me-2"></i>{% trans "السعر (أعلى لأقل)" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="views">
                                        <i class="fas fa-eye me-2"></i>{% trans "الأكثر مشاهدة" %}
                                    </a></li>

                                    <li><hr class="dropdown-divider"></li>

                                    <!-- Ad Type Filter -->
                                    <li>
                                        <h6 class="dropdown-header">
                                            <i class="fas fa-tags me-2"></i>
                                            {% trans "نوع الإعلان" %}
                                        </h6>
                                    </li>
                                    <li><a class="dropdown-item filter-option active" href="#" data-type="all">
                                        <i class="fas fa-th-large me-2"></i>{% trans "جميع الإعلانات" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-type="featured">
                                        <i class="fas fa-star me-2"></i>{% trans "إعلانات مميزة" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-type="urgent">
                                        <i class="fas fa-bolt me-2"></i>{% trans "إعلانات عاجلة" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-type="verified">
                                        <i class="fas fa-shield-alt me-2"></i>{% trans "إعلانات موثقة" %}
                                    </a></li>
                                </ul>
                            </div>

                            <!-- View Toggle -->
                            <div class="view-toggle-container">
                                <div class="view-toggle-buttons">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-primary active" id="heroGridViewToggle" data-view="grid">
                                            <i class="fas fa-th"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-primary" id="heroListViewToggle" data-view="list">
                                            <i class="fas fa-list"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Stats -->
                        <div class="quick-stats-bar">
                            <div class="stats-item">
                                <span class="stats-icon"><i class="fas fa-layer-group"></i></span>
                                <span class="stats-text">
                                    <span id="subcategoriesCount">{{ category.children.count|default:0 }}</span>
                                    {% trans "قسم فرعي" %}
                                </span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-icon"><i class="fas fa-bullhorn"></i></span>
                                <span class="stats-text">
                                    <span id="categoryAdsCount">{{ category.ads.count|default:0 }}</span>
                                    {% trans "إعلان" %}
                                </span>
                            </div>
                            <div class="stats-item">
                                <span class="stats-icon"><i class="fas fa-eye"></i></span>
                                <span class="stats-text">
                                    <span id="visibleAdsCount">{{ category.ads.count|default:0 }}</span>
                                    {% trans "معروض" %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modern Category Content Section -->
        <section class="modern-category-content">
                {% if breadcrumbs %}
                    <nav aria-label="breadcrumb" class="enhanced-breadcrumb mb-4">
                        <ol class="breadcrumb modern-breadcrumb-nav">
                            <li class="breadcrumb-item">
                                <a href="{% url 'main:home' %}" class="breadcrumb-link">
                                    <i class="fas fa-home me-2"></i>
                                    {% trans "الرئيسية" %}
                                </a>
                            </li>
                            <li class="breadcrumb-item">
                                <a href="{% url 'main:categories' %}" class="breadcrumb-link">
                                    <i class="fas fa-th-large me-2"></i>
                                    {% trans "جميع الأقسام" %}
                                </a>
                            </li>
                            {% for breadcrumb in breadcrumbs %}
                                {% if forloop.last %}
                                    <li class="breadcrumb-item active" aria-current="page">
                                        <span class="breadcrumb-active">
                                            {% if category.icon %}
                                                <i class="{{ category.icon }} me-2"></i>
                                            {% else %}
                                                <i class="fas fa-folder me-2"></i>
                                            {% endif %}
                                            {% if LANGUAGE_CODE == 'ar' and breadcrumb.name_ar %}
                                                {{ breadcrumb.name_ar }}
                                            {% else %}
                                                {{ breadcrumb.name }}
                                            {% endif %}
                                        </span>
                                    </li>
                                {% else %}
                                    <li class="breadcrumb-item">
                                        <a href="{% url 'main:category_detail' breadcrumb.slug %}" class="breadcrumb-link">
                                            {% if breadcrumb.icon %}
                                                <i class="{{ breadcrumb.icon }} me-2"></i>
                                            {% else %}
                                                <i class="fas fa-tag me-2"></i>
                                            {% endif %}
                                            {% if LANGUAGE_CODE == 'ar' and breadcrumb.name_ar %}
                                                {{ breadcrumb.name_ar }}
                                            {% else %}
                                                {{ breadcrumb.name }}
                                            {% endif %}
                                        </a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                        </ol>
                    </nav>
                {% endif %}

                <!-- Enhanced Category Header with Stats -->
                <div class="enhanced-hero-content">
                    <div class="category-header-wrapper">
                        <div class="category-main-info">
                            <div class="category-icon-wrapper">
                                {% if category.icon %}
                                    <i class="{{ category.icon }} category-hero-icon"></i>
                                {% else %}
                                    <i class="fas fa-folder category-hero-icon"></i>
                                {% endif %}
                            </div>
                            <div class="category-text-content">
                                <h1 class="modern-category-title">
                                    {% if LANGUAGE_CODE == 'ar' and category.name_ar %}
                                        {{ category.name_ar }}
                                    {% else %}
                                        {{ category.name }}
                                    {% endif %}
                                </h1>
                                {% if category.description %}
                                    <p class="modern-category-desc">
                                        {% if LANGUAGE_CODE == 'ar' and category.description_ar %}
                                            {{ category.description_ar }}
                                        {% else %}
                                            {{ category.description }}
                                        {% endif %}
                                    </p>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Enhanced Category Stats Cards -->
                        <div class="category-stats-enhanced">
                            <div class="stats-cards-grid">
                                <div class="stat-card-enhanced">
                                    <div class="stat-icon-wrapper">
                                        <i class="fas fa-bullhorn"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="categoryAdsCount">
                                            <i class="fas fa-spinner fa-spin"></i>
                                        </div>
                                        <div class="stat-label">{% trans "إعلان متاح" %}</div>
                                    </div>
                                </div>
                                <div class="stat-card-enhanced">
                                    <div class="stat-icon-wrapper">
                                        <i class="fas fa-sitemap"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-number" id="categorySubcatsCount">
                                            <i class="fas fa-spinner fa-spin"></i>
                                        </div>
                                        <div class="stat-label">{% trans "قسم فرعي" %}</div>
                                    </div>
                                </div>
                                <div class="stat-card-enhanced">
                                    <div class="stat-icon-wrapper">
                                        <i class="fas fa-eye"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-number">{{ category.view_count|default:0 }}</div>
                                        <div class="stat-label">{% trans "مشاهدة" %}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Search and Filter Bar -->
                    <div class="category-search-container">
                        <div class="search-filter-wrapper">
                            <!-- Search Input -->
                            <div class="search-input-group">
                                <div class="search-icon-wrapper">
                                    <i class="fas fa-search search-icon"></i>
                                </div>
                                <input type="text"
                                       id="categorySearchInput"
                                       class="form-control modern-search-input"
                                       placeholder="{% trans 'ابحث في الإعلانات والأقسام الفرعية...' %}"
                                       value="{{ current_filters.search }}"
                                       autocomplete="off">
                                <button type="button" id="clearSearchBtn" class="clear-search-btn" style="display: {% if current_filters.search %}block{% else %}none{% endif %};">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <!-- Price Range Filter -->
                            <div class="price-filter-group">
                                <div class="input-group">
                                    <input type="number" id="minPrice" class="form-control modern-search-input"
                                           placeholder="{% trans 'السعر من' %}" min="0" step="0.01"
                                           value="{{ current_filters.min_price }}">
                                    <span class="input-group-text">-</span>
                                    <input type="number" id="maxPrice" class="form-control modern-search-input"
                                           placeholder="{% trans 'السعر إلى' %}" min="0" step="0.01"
                                           value="{{ current_filters.max_price }}">
                                </div>
                            </div>

                            <!-- Location Filter -->
                            <div class="location-filter-group">
                                <input type="text" id="cityFilter" class="form-control modern-search-input"
                                       placeholder="{% trans 'المدينة' %}"
                                       value="{{ current_filters.city }}">
                            </div>

                            <!-- Filter Dropdown -->
                            <div class="filter-dropdown-container">
                                <button class="btn modern-filter-btn" type="button" id="filterDropdownBtn" data-bs-toggle="dropdown">
                                    <i class="fas fa-filter me-2"></i>
                                    <span class="filter-text">{% trans "فلترة" %}</span>
                                    <i class="fas fa-chevron-down ms-2"></i>
                                </button>
                                <ul class="dropdown-menu modern-dropdown-menu">
                                    <li>
                                        <h6 class="dropdown-header">
                                            <i class="fas fa-sort-amount-down me-2"></i>
                                            {% trans "ترتيب حسب" %}
                                        </h6>
                                    </li>
                                    <li><a class="dropdown-item filter-option {% if current_filters.sort == '-created_at' %}active{% endif %}" href="#" data-sort="-created_at">
                                        <i class="fas fa-clock me-2"></i>{% trans "الأحدث" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option {% if current_filters.sort == 'price' %}active{% endif %}" href="#" data-sort="price">
                                        <i class="fas fa-sort-numeric-down me-2"></i>{% trans "السعر (من الأقل)" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option {% if current_filters.sort == '-price' %}active{% endif %}" href="#" data-sort="-price">
                                        <i class="fas fa-sort-numeric-up me-2"></i>{% trans "السعر (من الأعلى)" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option {% if current_filters.sort == '-views_count' %}active{% endif %}" href="#" data-sort="-views_count">
                                        <i class="fas fa-eye me-2"></i>{% trans "الأكثر مشاهدة" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option {% if current_filters.sort == 'title' %}active{% endif %}" href="#" data-sort="title">
                                        <i class="fas fa-sort-alpha-down me-2"></i>{% trans "العنوان أ-ي" %}
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <h6 class="dropdown-header">
                                            <i class="fas fa-filter me-2"></i>
                                            {% trans "خيارات إضافية" %}
                                        </h6>
                                    </li>
                                    <li>
                                        <div class="dropdown-item-text">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="negotiableFilter"
                                                       {% if current_filters.negotiable %}checked{% endif %}>
                                                <label class="form-check-label" for="negotiableFilter">
                                                    <i class="fas fa-handshake me-2"></i>{% trans "قابل للتفاوض" %}
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="dropdown-item-text">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="deliveryFilter"
                                                       {% if current_filters.delivery %}checked{% endif %}>
                                                <label class="form-check-label" for="deliveryFilter">
                                                    <i class="fas fa-shipping-fast me-2"></i>{% trans "توصيل متوفر" %}
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="dropdown-item-text">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="verifiedFilter"
                                                       {% if current_filters.verified_only %}checked{% endif %}>
                                                <label class="form-check-label" for="verifiedFilter">
                                                    <i class="fas fa-shield-alt me-2"></i>{% trans "أعضاء موثقون فقط" %}
                                                </label>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                            </div>
                                <ul class="dropdown-menu modern-dropdown-menu">
                                    <li>
                                        <h6 class="dropdown-header">
                                            <i class="fas fa-sort-amount-down me-2"></i>
                                            {% trans "ترتيب الإعلانات" %}
                                        </h6>
                                    </li>
                                    <li><a class="dropdown-item filter-option active" href="#" data-sort="recent">
                                        <i class="fas fa-clock me-2"></i>{% trans "الأحدث" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="price_low">
                                        <i class="fas fa-sort-amount-down me-2"></i>{% trans "السعر من الأقل" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="price_high">
                                        <i class="fas fa-sort-amount-up me-2"></i>{% trans "السعر من الأعلى" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-sort="views">
                                        <i class="fas fa-eye me-2"></i>{% trans "الأكثر مشاهدة" %}
                                    </a></li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <h6 class="dropdown-header">
                                            <i class="fas fa-tags me-2"></i>
                                            {% trans "نوع المحتوى" %}
                                        </h6>
                                    </li>
                                    <li><a class="dropdown-item filter-option active" href="#" data-type="all">
                                        <i class="fas fa-th-large me-2"></i>{% trans "الكل" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-type="ads">
                                        <i class="fas fa-bullhorn me-2"></i>{% trans "الإعلانات فقط" %}
                                    </a></li>
                                    <li><a class="dropdown-item filter-option" href="#" data-type="subcategories">
                                        <i class="fas fa-sitemap me-2"></i>{% trans "الأقسام الفرعية فقط" %}
                                    </a></li>
                                </ul>
                            </div>

                            <!-- View Toggle -->
                            <div class="view-toggle-container">
                                <div class="view-toggle-buttons">
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-outline-primary active" id="gridViewToggle" data-view="grid">
                                            <i class="fas fa-th"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-primary" id="listViewToggle" data-view="list">
                                            <i class="fas fa-list"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modern Content Section -->
        <section class="modern-category-content">
            <div class="container">
                <!-- Loading Overlay -->
                <div class="loading-overlay" id="contentLoader" style="display: none;">
                    <div class="loading-spinner">
                        <div class="spinner-ring"></div>
                        <p class="loading-text">{% trans "جارٍ التحميل..." %}</p>
                    </div>
                </div>

                <!-- No Results Message -->
                <div class="no-results-message" id="noResultsMessage" style="display: none;">
                    <div class="no-results-icon">
                        <i class="fas fa-search-minus"></i>
                    </div>
                    <h3 class="no-results-title">{% trans "لم يتم العثور على نتائج" %}</h3>
                    <p class="no-results-text">{% trans "جرب البحث بكلمات مختلفة أو تعديل الفلترة" %}</p>
                    <button class="btn btn-primary reset-filters-btn" id="resetFiltersBtn">
                        <i class="fas fa-refresh me-2"></i>{% trans "إعادة تعيين" %}
                    </button>
                </div>

                <!-- Subcategories Section -->
                <div class="subcategories-section-modern" id="subcategoriesSection">
                    <div class="section-header-modern">
                        <div class="section-header-content">
                            <div class="section-icon-wrapper">
                                <i class="fas fa-sitemap"></i>
                            </div>
                            <div class="section-content-header">
                                <h2 class="section-title-modern">{% trans "الأقسام الفرعية" %}</h2>
                                <p class="section-subtitle" id="subcategoriesCount">{% trans "استكشف الأقسام الفرعية المتاحة" %}</p>
                            </div>
                        </div>
                        <div class="section-actions">
                            <div class="section-stats">
                                <span class="stats-badge" id="subcategoriesStatsCount">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                            </div>
                            <div class="section-toggle">
                                <button class="btn section-toggle-btn" id="subcategoriesToggle" data-target="subcategoriesContent">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="section-content-modern" id="subcategoriesContent">
                        <!-- Subcategories Grid -->
                        <div id="subcategoriesGrid" class="content-grid" data-view="grid">
                            <!-- Subcategories will be loaded here via AJAX -->
                        </div>

                        <!-- No subcategories message -->
                        <div id="noSubcategoriesMessage" class="empty-state" style="display: none;">
                            <div class="empty-icon">
                                <i class="fas fa-folder-open"></i>
                            </div>
                            <h4 class="empty-title">{% trans "لا توجد أقسام فرعية" %}</h4>
                            <p class="empty-desc">{% trans "لا توجد أقسام فرعية لهذا القسم حالياً" %}</p>
                        </div>
                    </div>
                </div>

                <!-- Ads Section -->
                <div class="ads-section-modern" id="adsSection">
                    <div class="section-header-modern">
                        <div class="section-header-content">
                            <div class="section-icon-wrapper">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <div class="section-content-header">
                                <h2 class="section-title-modern">{% trans "الإعلانات المتاحة" %}</h2>
                                <p class="section-subtitle">{% trans "تصفح جميع الإعلانات في هذا القسم" %}</p>
                            </div>
                        </div>
                        <div class="section-actions">
                            <div class="section-stats">
                                <span class="stats-badge" id="adsStatsCount">{{ ads|length }}</span>
                            </div>
                            <div class="section-toggle">
                                <button class="btn section-toggle-btn" id="adsToggle" data-target="adsContent">
                                    <i class="fas fa-chevron-down"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="section-content-modern" id="adsContent">
                        <!-- Ads Grid/List -->
                        <div id="adsContainer" class="content-grid" data-view="grid">
                            <div class="row" id="adsBootstrapGrid">
                                {% for ad in ads %}
                                    <div class="col-xl-3 col-lg-4 col-md-6 col-sm-12 mb-4 bootstrap-ad-card" data-category="{{ ad.category.slug|default:'' }}">
                                        {% include "partials/_ad_card_component.html" with ad=ad %}
                                    </div>
                                {% empty %}
                            </div>
                            <div class="col-12">
                                <div class="empty-state">
                                    <div class="empty-icon">
                                        <i class="fas fa-bullhorn"></i>
                                    </div>
                                    <h4 class="empty-title">{% trans "لا توجد إعلانات" %}</h4>
                                    <p class="empty-desc">{% trans "لا توجد إعلانات في هذا القسم حالياً" %}</p>
                                    <a href="{% url 'main:ad_create' %}" class="btn btn-primary">
                                        <i class="fas fa-plus me-2"></i>{% trans "أضف إعلانك الأول" %}
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- Pagination -->
                        {% if is_paginated %}
                            <nav aria-label="Page navigation" class="pagination-modern">
                                <ul class="pagination justify-content-center">
                                    {% if page_obj.has_previous %}
                                        <li class="page-item">
                                            <a class="page-link modern-page-link" href="?page={{ page_obj.previous_page_number }}&{{ query_params }}">
                                                <i class="fas fa-chevron-left me-1"></i>{% trans "السابق" %}
                                            </a>
                                        </li>
                                    {% endif %}

                                    {% for num in paginator.page_range %}
                                        {% if page_obj.number == num %}
                                            <li class="page-item active">
                                                <span class="page-link modern-page-link">{{ num }}</span>
                                            </li>
                                        {% else %}
                                            <li class="page-item">
                                                <a class="page-link modern-page-link" href="?page={{ num }}&{{ query_params }}">{{ num }}</a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}

                                    {% if page_obj.has_next %}
                                        <li class="page-item">
                                            <a class="page-link modern-page-link" href="?page={{ page_obj.next_page_number }}&{{ query_params }}">
                                                {% trans "التالي" %}<i class="fas fa-chevron-right ms-1"></i>
                                            </a>
                                        </li>
                                    {% endif %}
                                </ul>
                            </nav>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>

    {% else %}
        <!-- Category not found -->
        <section class="error-section">
            <div class="container">
                <div class="error-state-modern">
                    <div class="error-icon-wrapper">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h2 class="error-title-modern">{% trans "القسم غير موجود" %}</h2>
                    <p class="error-message-modern">{% trans "عذراً، القسم المطلوب غير موجود أو غير متاح حالياً" %}</p>
                    <div class="error-actions-modern">
                        <a href="{% url 'main:categories' %}" class="btn btn-primary btn-lg">
                            <i class="fas fa-th-large me-2"></i>{% trans "تصفح الأقسام" %}
                        </a>
                        <a href="{% url 'main:home' %}" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-home me-2"></i>{% trans "العودة للرئيسية" %}
                        </a>
                    </div>
                </div>
            </div>
        </section>
    {% endif %}
{% endblock content %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const categoryId = {{ category.id|default:0 }};

    // Initialize Modern Category Detail Manager
    class ModernCategoryDetailManager {
        constructor(categoryId) {
            this.categoryId = categoryId;
            this.currentSort = 'date';
            this.currentType = 'all';
            this.searchQuery = '';
            this.currentView = 'grid';
            this.currentCountry = '';
            this.priceRange = { min: null, max: null };

            // Initialize DOM elements
            this.searchInput = document.getElementById('categorySearchInput');
            this.clearSearchBtn = document.getElementById('clearSearchBtn');
            this.countryFilter = document.getElementById('countryFilter');
            this.minPriceInput = document.getElementById('minPrice');
            this.maxPriceInput = document.getElementById('maxPrice');
            this.filterDropdown = document.getElementById('filterDropdownBtn');
            this.contentLoader = document.getElementById('contentLoader');
            this.noResults = document.getElementById('noResultsMessage');

            // View toggle buttons (new IDs)
            this.heroGridViewToggle = document.getElementById('heroGridViewToggle');
            this.heroListViewToggle = document.getElementById('heroListViewToggle');
            this.gridViewToggle = document.getElementById('gridViewToggle');
            this.listViewToggle = document.getElementById('listViewToggle');

            // Legacy support for old IDs
            this.gridViewBtn = document.getElementById('gridViewBtn') || this.gridViewToggle;
            this.listViewBtn = document.getElementById('listViewBtn') || this.listViewToggle;

            this.subcategoriesSection = document.getElementById('subcategoriesSection');
            this.adsSection = document.getElementById('adsSection');
            this.subcategoriesGrid = document.getElementById('subcategoriesGrid');
            this.adsContainer = document.getElementById('adsContainer');

            this.currentSort = 'recent';
            this.currentType = 'all';
            this.searchQuery = '';
            this.currentLayout = 'grid';
            this.debounceTimeout = null;

            this.init();
        }

        init() {
            this.loadCategoryData();
            this.setupSearchFunctionality();
            this.setupFilterFunctionality();
            this.setupPriceFiltering();
            this.setupLocationFiltering();
            this.setupAdvancedFiltering();
            this.setupViewToggle();
            this.setupSectionToggling();
            this.setupAnimations();

            console.log('✅ Modern Category Detail Manager initialized');
        }

        loadCategoryData() {
            if (!this.categoryId) return;

            // Load subcategories
            this.loadSubcategories();

            // Load category stats
            this.loadCategoryStats();
        }

        setupSearchFunctionality() {
            if (!this.searchInput) return;

            // Real-time search with debouncing
            let searchTimeout;
            this.searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim();

                if (query.length > 0) {
                    this.clearSearchBtn.style.display = 'block';
                } else {
                    this.clearSearchBtn.style.display = 'none';
                }

                searchTimeout = setTimeout(() => {
                    this.searchQuery = query;
                    this.filterContent();
                }, 300);
            });

            // Clear search functionality
            this.clearSearchBtn?.addEventListener('click', () => {
                this.searchInput.value = '';
                this.clearSearchBtn.style.display = 'none';
                this.searchQuery = '';
                this.filterContent();
                this.searchInput.focus();
            });

            // Search on enter
            this.searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    this.searchQuery = this.searchInput.value.trim();
                    this.filterContent();
                }
            });
        }

        setupFilterFunctionality() {
            // Filter option clicks
            document.querySelectorAll('.filter-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    e.preventDefault();

                    // Remove active class from all options in this group
                    const parent = option.closest('.dropdown-menu');
                    if (option.dataset.sort) {
                        parent.querySelectorAll('[data-sort]').forEach(o => o.classList.remove('active'));
                        this.currentSort = option.dataset.sort;
                    } else if (option.dataset.type) {
                        parent.querySelectorAll('[data-type]').forEach(o => o.classList.remove('active'));
                        this.currentType = option.dataset.type;
                    }

                    option.classList.add('active');
                    this.filterContent();

                    // Update filter button text
                    this.updateFilterButtonText();
                });
            });

            // Reset filters button
            document.getElementById('resetFiltersBtn')?.addEventListener('click', () => {
                this.resetFilters();
            });
        },

        setupPriceFiltering() {
            const minPriceInput = document.getElementById('min-price');
            const maxPriceInput = document.getElementById('max-price');

            if (minPriceInput && maxPriceInput) {
                [minPriceInput, maxPriceInput].forEach(input => {
                    input.addEventListener('input', () => {
                        this.debounced(() => this.applyFilters(), 500);
                    });
                });
            }
        },

        setupLocationFiltering() {
            const locationInput = document.getElementById('location');

            if (locationInput) {
                locationInput.addEventListener('input', () => {
                    this.debounced(() => this.applyFilters(), 500);
                });
            }
        },

        setupAdvancedFiltering() {
            const sortSelect = document.getElementById('sort');
            const negotiableCheckbox = document.getElementById('negotiable');
            const deliveryCheckbox = document.getElementById('delivery');
            const verifiedCheckbox = document.getElementById('verified');

            [sortSelect, negotiableCheckbox, deliveryCheckbox, verifiedCheckbox].forEach(element => {
                if (element) {
                    element.addEventListener('change', () => this.applyFilters());
                }
            });
        },

        applyFilters() {
            const searchValue = document.getElementById('search-input')?.value || '';
            const minPrice = document.getElementById('min-price')?.value || '';
            const maxPrice = document.getElementById('max-price')?.value || '';
            const location = document.getElementById('location')?.value || '';
            const sortBy = document.getElementById('sort')?.value || '';
            const negotiable = document.getElementById('negotiable')?.checked || false;
            const delivery = document.getElementById('delivery')?.checked || false;
            const verified = document.getElementById('verified')?.checked || false;

            const params = new URLSearchParams();
            if (searchValue) params.append('search', searchValue);
            if (minPrice) params.append('min_price', minPrice);
            if (maxPrice) params.append('max_price', maxPrice);
            if (location) params.append('location', location);
            if (sortBy) params.append('ordering', sortBy);
            if (negotiable) params.append('negotiable', 'true');
            if (delivery) params.append('delivery', 'true');
            if (verified) params.append('verified', 'true');

            // Add category to maintain context
            if (this.categoryData.id) {
                params.append('category', this.categoryData.id);
            }

            // Update URL without page reload
            const newUrl = `${window.location.pathname}?${params.toString()}`;
            window.history.pushState({}, '', newUrl);

            // Apply filters to visible ads
            this.filterAds({
                search: searchValue,
                minPrice,
                maxPrice,
                location,
                sortBy,
                negotiable,
                delivery,
                verified
            });
        },

        filterAds(filters) {
            // Client-side filtering demonstration (replace with AJAX in production)
            console.log('Applying filters:', filters);

            const adCards = document.querySelectorAll('.classified-ad-card');

            adCards.forEach(card => {
                let shouldShow = true;

                // Search filter
                if (filters.search) {
                    const title = card.querySelector('.ad-title')?.textContent.toLowerCase() || '';
                    const description = card.querySelector('.ad-description')?.textContent.toLowerCase() || '';
                    const searchTerm = filters.search.toLowerCase();

                    if (!title.includes(searchTerm) && !description.includes(searchTerm)) {
                        shouldShow = false;
                    }
                }

                // Price filters
                if (filters.minPrice || filters.maxPrice) {
                    const priceElement = card.querySelector('.ad-price');
                    const priceText = priceElement?.textContent.replace(/[^\d.]/g, '') || '0';
                    const price = parseFloat(priceText);

                    if (filters.minPrice && price < parseFloat(filters.minPrice)) {
                        shouldShow = false;
                    }
                    if (filters.maxPrice && price > parseFloat(filters.maxPrice)) {
                        shouldShow = false;
                    }
                }

                // Location filter
                if (filters.location) {
                    const location = card.querySelector('.ad-location')?.textContent.toLowerCase() || '';
                    if (!location.includes(filters.location.toLowerCase())) {
                        shouldShow = false;
                    }
                }

                // Show/hide card with animation
                if (shouldShow) {
                    card.style.display = 'block';
                    gsap.to(card, { opacity: 1, scale: 1, duration: 0.3 });
                } else {
                    gsap.to(card, {
                        opacity: 0,
                        scale: 0.9,
                        duration: 0.3,
                        onComplete: () => card.style.display = 'none'
                    });
                }
            });
        },

        debounced(func, delay) {
            clearTimeout(this.debounceTimeout);
            this.debounceTimeout = setTimeout(func, delay);
        }

        setupViewToggle() {
            // Handle all view toggle buttons
            const allGridButtons = [
                this.gridViewBtn,
                this.gridViewToggle,
                this.heroGridViewToggle,
                document.getElementById('gridViewBtn')
            ].filter(btn => btn);

            const allListButtons = [
                this.listViewBtn,
                this.listViewToggle,
                this.heroListViewToggle,
                document.getElementById('listViewBtn')
            ].filter(btn => btn);

            // Grid view handlers
            allGridButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    this.setLayout('grid');
                });
            });

            // List view handlers
            allListButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    this.setLayout('list');
                });
            });

            // Country filter handler
            if (this.countryFilter) {
                this.countryFilter.addEventListener('change', (e) => {
                    this.currentCountry = e.target.value;
                    this.applyFilters();
                });
            }

            // Price range handlers
            if (this.minPriceInput) {
                this.minPriceInput.addEventListener('input', (e) => {
                    this.priceRange.min = e.target.value ? parseFloat(e.target.value) : null;
                    this.debounced(() => this.applyFilters(), 500);
                });
            }

            if (this.maxPriceInput) {
                this.maxPriceInput.addEventListener('input', (e) => {
                    this.priceRange.max = e.target.value ? parseFloat(e.target.value) : null;
                    this.debounced(() => this.applyFilters(), 500);
                });
            }
        }

        setupSectionToggling() {
            // Enhanced section toggle functionality
            document.querySelectorAll('.section-toggle-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = btn.dataset.target;
                    const targetElement = document.getElementById(targetId);
                    const chevronIcon = btn.querySelector('i');

                    if (targetElement) {
                        const isCollapsed = targetElement.style.display === 'none';

                        if (isCollapsed) {
                            // Expand section
                            targetElement.style.display = 'block';
                            chevronIcon.style.transform = 'rotate(0deg)';
                            btn.classList.remove('collapsed');

                            // Animate section expansion
                            if (globalThis.gsap) {
                                globalThis.gsap.from(targetElement, {
                                    height: 0,
                                    opacity: 0,
                                    duration: 0.3,
                                    ease: 'power2.out'
                                });
                            }
                        } else {
                            // Collapse section
                            if (globalThis.gsap) {
                                globalThis.gsap.to(targetElement, {
                                    height: 0,
                                    opacity: 0,
                                    duration: 0.3,
                                    ease: 'power2.in',
                                    onComplete: () => {
                                        targetElement.style.display = 'none';
                                        targetElement.style.height = 'auto';
                                        targetElement.style.opacity = '1';
                                    }
                                });
                            } else {
                                targetElement.style.display = 'none';
                            }

                            chevronIcon.style.transform = 'rotate(180deg)';
                            btn.classList.add('collapsed');
                        }
                    }
                });
            });

            // Update section counters
            this.updateSectionCounters();
        }

        updateSectionCounters() {
            // Update subcategories counter
            const subcatsCount = document.querySelectorAll('.content-item[data-type="subcategory"]').length;
            const subcatsStatsElement = document.getElementById('subcategoriesStatsCount');
            if (subcatsStatsElement) {
                subcatsStatsElement.innerHTML = subcatsCount;
            }

            // Update ads counter (already done, but make sure it's current)
            const adsCount = document.querySelectorAll('.bootstrap-ad-card').length;
            const adsStatsElement = document.getElementById('adsStatsCount');
            if (adsStatsElement && !adsStatsElement.textContent.includes('fa-')) {
                adsStatsElement.innerHTML = adsCount;
            }
        }

        setupAnimations() {
            if (globalThis.gsap && globalThis.ScrollTrigger) {
                // Hero animation
                globalThis.gsap.from('.modern-category-title', {
                    y: 50,
                    opacity: 0,
                    duration: 0.8,
                    ease: 'power2.out'
                });

                globalThis.gsap.from('.modern-category-desc', {
                    y: 30,
                    opacity: 0,
                    duration: 0.8,
                    delay: 0.2,
                    ease: 'power2.out'
                });

                globalThis.gsap.from('.category-search-container', {
                    y: 40,
                    opacity: 0,
                    duration: 0.8,
                    delay: 0.4,
                    ease: 'power2.out'
                });

                // Stats cards animation
                globalThis.gsap.from('.stat-card-modern', {
                    scale: 0.8,
                    opacity: 0,
                    duration: 0.6,
                    delay: 0.3,
                    stagger: 0.1,
                    ease: 'back.out(1.7)'
                });

                // Content sections animation
                globalThis.gsap.from('.section-header-modern', {
                    scrollTrigger: {
                        trigger: '.modern-category-content',
                        start: 'top 85%'
                    },
                    y: 30,
                    opacity: 0,
                    duration: 0.6,
                    stagger: 0.2,
                    ease: 'power2.out'
                });
            }
        }

        loadSubcategories() {
            const loadingIndicator = document.getElementById('subcategoriesLoading');
            const noSubcatsMessage = document.getElementById('noSubcategoriesMessage');

            fetch(`/ajax/subcategories/${this.categoryId}/`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        console.error('Error loading subcategories:', data.error);
                        noSubcatsMessage.style.display = 'block';
                        return;
                    }

                    if (data.subcategories && data.subcategories.length > 0) {
                        this.renderSubcategories(data.subcategories);
                    } else {
                        noSubcatsMessage.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error fetching subcategories:', error);
                    noSubcatsMessage.style.display = 'block';
                });
        }

        renderSubcategories(subcategories) {
            this.subcategoriesGrid.innerHTML = '';

            subcategories.forEach(subcat => {
                const subcatCard = this.createSubcategoryCard(subcat);
                this.subcategoriesGrid.appendChild(subcatCard);
            });

            // Add click handlers for subcategory cards
            this.addSubcategoryClickHandlers();

            // Update section counters
            this.updateSectionCounters();

            // Animate in
            if (globalThis.gsap) {
                globalThis.gsap.from('.subcategory-card-modern', {
                    y: 30,
                    opacity: 0,
                    duration: 0.5,
                    stagger: 0.1,
                    ease: 'power2.out'
                });
            }
        }

        createSubcategoryCard(subcat) {
            const wrapper = document.createElement('div');
            wrapper.className = 'content-item';
            wrapper.dataset.type = 'subcategory';
            wrapper.dataset.title = subcat.name.toLowerCase();

            wrapper.innerHTML = `
                <div class="subcategory-card-modern" data-category-id="${subcat.id}" data-category-slug="${subcat.slug}">
                    <div class="card-header-modern">
                        <div class="subcategory-icon-modern">
                            <i class="${subcat.icon || 'fas fa-tag'}"></i>
                        </div>
                        ${subcat.has_children ? '<div class="subcategory-badge-modern"><i class="fas fa-plus"></i></div>' : ''}
                    </div>
                    <div class="card-content-modern">
                        <h4 class="subcategory-title-modern">${subcat.name}</h4>
                        <div class="subcategory-stats-modern">
                            <div class="stat-item-modern">
                                <span class="stat-count-modern" data-stat="ads">
                                    <i class="fas fa-spinner fa-spin"></i>
                                </span>
                                <span class="stat-label-modern">{% trans "إعلان" %}</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-actions-modern">
                        <button class="btn btn-primary btn-sm view-subcategory" onclick="viewSubcategory('${subcat.slug}')">
                            <i class="fas fa-eye me-1"></i>{% trans "عرض" %}
                        </button>
                        <button class="btn btn-outline-primary btn-sm load-subcat-data"
                                onclick="loadSubcategoryData(${subcat.id})"
                                title="{% trans 'تحميل البيانات' %}">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>
            `;

            // Load subcategory stats
            setTimeout(() => this.loadSubcategoryStats(subcat.id), 100);

            return wrapper;
        }

        addSubcategoryClickHandlers() {
            document.querySelectorAll('.subcategory-card-modern').forEach(card => {
                card.addEventListener('click', function(e) {
                    if (e.target.closest('.card-actions-modern')) return;

                    const slug = this.dataset.categorySlug;
                    if (slug) {
                        // Add loading animation
                        card.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            globalThis.location.href = `/category/${slug}/`;
                        }, 200);
                    }
                });

                // Hover effects
                card.addEventListener('mouseenter', () => {
                    if (globalThis.gsap) {
                        globalThis.gsap.to(card, {
                            y: -8,
                            scale: 1.02,
                            duration: 0.3,
                            ease: 'power2.out'
                        });
                    }
                });

                card.addEventListener('mouseleave', () => {
                    if (globalThis.gsap) {
                        globalThis.gsap.to(card, {
                            y: 0,
                            scale: 1,
                            duration: 0.3,
                            ease: 'power2.out'
                        });
                    }
                });
            });
        }

        loadSubcategoryStats(subcatId) {
            fetch(`/ajax/category-stats/?category_id=${subcatId}`)
                .then(response => response.json())
                .then(data => {
                    const statElement = document.querySelector(`[data-category-id="${subcatId}"] [data-stat="ads"]`);
                    if (statElement) {
                        statElement.innerHTML = data.ads_count || 0;
                    }
                })
                .catch(error => {
                    console.error('Error loading subcategory stats:', error);
                    const statElement = document.querySelector(`[data-category-id="${subcatId}"] [data-stat="ads"]`);
                    if (statElement) {
                        statElement.innerHTML = '0';
                    }
                });
        }

        loadCategoryStats() {
            fetch(`/ajax/category-stats/?category_id=${this.categoryId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('categoryAdsCount').textContent = data.ads_count || 0;
                    document.getElementById('categorySubcatsCount').textContent = data.subcategories_count || 0;
                })
                .catch(error => {
                    console.error('Error loading category stats:', error);
                    document.getElementById('categoryAdsCount').textContent = '0';
                    document.getElementById('categorySubcatsCount').textContent = '0';
                });
        }

        filterContent() {
            this.showLoader();

            setTimeout(() => {
                // Handle subcategories (still using content-item)
                const allSubcatItems = document.querySelectorAll('.content-item[data-type="subcategory"]');
                // Handle ads (now using bootstrap-ad-card)
                const allAdItems = document.querySelectorAll('.bootstrap-ad-card');

                let visibleCount = 0;
                let hasResults = false;

                // Filter subcategories
                allSubcatItems.forEach(item => {
                    const itemType = item.dataset.type;
                    const itemTitle = item.dataset.title || '';

                    let shouldShow = true;

                    // Type filter
                    if (this.currentType !== 'all') {
                        if (this.currentType === 'ads') {
                            shouldShow = false; // Hide subcategories when filtering for ads only
                        } else if (this.currentType === 'subcategories' && itemType !== 'subcategory') {
                            shouldShow = false;
                        }
                    }

                    // Search filter
                    if (this.searchQuery && !itemTitle.includes(this.searchQuery.toLowerCase())) {
                        shouldShow = false;
                    }

                    // Apply visibility
                    if (shouldShow) {
                        item.style.display = 'block';
                        this.animateIn(item);
                        visibleCount++;
                        hasResults = true;
                    } else {
                        item.style.display = 'none';
                    }
                });

                // Filter ads
                allAdItems.forEach(item => {
                    // Get ad data from the included ad card
                    const adCard = item.querySelector('.modern-ad-card');
                    const adTitle = adCard ? (adCard.querySelector('.ad-title')?.textContent || '').toLowerCase() : '';

                    let shouldShow = true;

                    // Type filter
                    if (this.currentType !== 'all') {
                        if (this.currentType === 'subcategories') {
                            shouldShow = false; // Hide ads when filtering for subcategories only
                        }
                    }

                    // Search filter
                    if (this.searchQuery && !adTitle.includes(this.searchQuery.toLowerCase())) {
                        shouldShow = false;
                    }

                    // Apply visibility
                    if (shouldShow) {
                        item.style.display = 'block';
                        this.animateIn(item);
                        visibleCount++;
                        hasResults = true;
                    } else {
                        item.style.display = 'none';
                    }
                });

                // Sort visible items
                this.sortContent();

                // Update sections visibility
                this.updateSectionsVisibility();

                this.hideLoader();

                if (!hasResults) {
                    this.showNoResults();
                } else {
                    this.hideNoResults();
                }
            }, 300);
        }

        sortContent() {
            const adsItems = Array.from(document.querySelectorAll('.bootstrap-ad-card'));
            const visibleAdsItems = adsItems.filter(item => item.style.display !== 'none');

            if (this.currentSort && visibleAdsItems.length > 0) {
                visibleAdsItems.sort((a, b) => {
                    if (this.currentSort === 'price_low') {
                        return (parseFloat(a.dataset.price) || 0) - (parseFloat(b.dataset.price) || 0);
                    } else if (this.currentSort === 'price_high') {
                        return (parseFloat(b.dataset.price) || 0) - (parseFloat(a.dataset.price) || 0);
                    } else if (this.currentSort === 'recent') {
                        // Sort by creation date (if available)
                        return 0; // Placeholder
                    }
                    return 0;
                });

                // Re-append in sorted order
                visibleAdsItems.forEach(item => {
                    this.adsContainer.appendChild(item);
                });
            }
        }

        updateSectionsVisibility() {
            const hasVisibleSubcats = document.querySelectorAll('.content-item[data-type="subcategory"]:not([style*="display: none"])').length > 0;
            const hasVisibleAds = document.querySelectorAll('.bootstrap-ad-card:not([style*="display: none"])').length > 0;

            if (this.subcategoriesSection) {
                this.subcategoriesSection.style.display = hasVisibleSubcats ? 'block' : 'none';
            }

            if (this.adsSection) {
                this.adsSection.style.display = hasVisibleAds ? 'block' : 'none';
            }
        }

        setLayout(layout) {
            this.currentLayout = layout;

            // Update all button states
            const allButtons = [
                this.gridViewBtn,
                this.gridViewToggle,
                this.heroGridViewToggle,
                this.listViewBtn,
                this.listViewToggle,
                this.heroListViewToggle,
                document.getElementById('gridViewBtn'),
                document.getElementById('listViewBtn')
            ].filter(btn => btn);

            allButtons.forEach(btn => {
                const isGridBtn = btn.dataset.view === 'grid' ||
                                  btn.id?.includes('grid') ||
                                  btn === this.gridViewBtn ||
                                  btn === this.gridViewToggle ||
                                  btn === this.heroGridViewToggle;

                if (isGridBtn) {
                    btn.classList.toggle('active', layout === 'grid');
                } else {
                    btn.classList.toggle('active', layout === 'list');
                }
            });

            // Update container layouts
            document.querySelectorAll('.content-grid, .ads-grid, #adsBootstrapGrid').forEach(container => {
                container.setAttribute('data-view', layout);
            });
        }

        updateFilterButtonText() {
            const activeType = document.querySelector('.filter-option[data-type].active');
            const activeSort = document.querySelector('.filter-option[data-sort].active');

            if (activeType && activeType.dataset.type !== 'all') {
                this.filterDropdown.querySelector('.filter-text').textContent = activeType.textContent.trim();
            } else {
                this.filterDropdown.querySelector('.filter-text').textContent = '{% trans "فلترة" %}';
            }
        }

        resetFilters() {
            this.searchInput.value = '';
            this.clearSearchBtn.style.display = 'none';
            this.searchQuery = '';
            this.currentType = 'all';
            this.currentSort = 'recent';

            // Reset filter options
            document.querySelectorAll('.filter-option').forEach(option => {
                option.classList.remove('active');
                if (option.dataset.type === 'all' || option.dataset.sort === 'recent') {
                    option.classList.add('active');
                }
            });

            this.updateFilterButtonText();
            this.filterContent();
        }

        showLoader() {
            this.contentLoader.style.display = 'flex';
        }

        hideLoader() {
            this.contentLoader.style.display = 'none';
        }

        showNoResults() {
            this.noResults.style.display = 'block';
        }

        hideNoResults() {
            this.noResults.style.display = 'none';
        }

        animateIn(element) {
            if (globalThis.gsap) {
                globalThis.gsap.from(element, {
                    y: 20,
                    opacity: 0,
                    duration: 0.4,
                    ease: 'power2.out'
                });
            }
        }
    }

    // Initialize the manager
    globalThis.categoryManager = new ModernCategoryDetailManager(categoryId);

    // Global functions for onclick handlers
    globalThis.viewSubcategory = function(slug) {
        globalThis.location.href = `/category/${slug}/`;
    };

    globalThis.loadSubcategoryData = function(categoryId) {
        // Show modal or sidebar with detailed subcategory information
        showSubcategoryModal(categoryId);
    };

    function showSubcategoryModal(categoryId) {
        // Create and show a modal with subcategory details
        fetch(`/ajax/subcategories/${categoryId}/`)
            .then(response => response.json())
            .then(data => {
                // Implementation for modal showing subcategory details
                console.log('Subcategory data:', data);
                // You can implement a modal here to show detailed information
            })
            .catch(error => {
                console.error('Error loading subcategory details:', error);
            });
    }
});
</script>
{% endblock extra_js %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/categories-enhanced.css' %}">
    <style>
        /* Category Detail Page - Only page-specific overrides */
        /* All common styles are in categories-enhanced.css and style.css */

        /* Only keep absolutely necessary category_detail specific styles here */
    </style>
{% endblock extra_css %}

    /* Modern Category Hero Section */
    .modern-category-hero {
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        min-height: 70vh;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
        color: white;
    }

    .hero-background-gradient {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="white" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
        opacity: 0.3;
    }

    .hero-content-modern {
        position: relative;
        z-index: 10;
        text-align: center;
        max-width: 800px;
        margin: 0 auto;
    }

    /* Enhanced Modern Breadcrumbs */
    .enhanced-breadcrumb {
        position: relative;
        z-index: 10;
        margin-bottom: 2rem;
    }

    .modern-breadcrumb-nav {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 50px;
        padding: 12px 24px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(15px);
        margin: 0;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        position: relative;
    }

    .modern-breadcrumb-nav::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.6s ease;
    }

    .enhanced-breadcrumb:hover .modern-breadcrumb-nav::before {
        left: 100%;
    }

    .modern-breadcrumb-nav .breadcrumb-item {
        display: flex;
        align-items: center;
        position: relative;
    }

    .modern-breadcrumb-nav .breadcrumb-item + .breadcrumb-item::before {
        content: "›";
        color: rgba(255, 255, 255, 0.6);
        font-size: 1.2rem;
        font-weight: 600;
        margin: 0 8px;
        padding: 0;
        float: none;
    }

    .breadcrumb-link {
        color: rgba(255, 255, 255, 0.9);
        text-decoration: none;
        transition: all 0.3s ease;
        padding: 6px 12px;
        border-radius: 25px;
        display: flex;
        align-items: center;
        font-weight: 500;
        position: relative;
        overflow: hidden;
    }

    .breadcrumb-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        opacity: 0;
        transition: opacity 0.3s ease;
        border-radius: 25px;
    }

    .breadcrumb-link:hover {
        color: white;
        transform: translateY(-1px);
    }

    .breadcrumb-link:hover::before {
        opacity: 1;
    }

    .breadcrumb-link i {
        position: relative;
        z-index: 1;
    }

    .breadcrumb-link span:not(.breadcrumb-active) {
        position: relative;
        z-index: 1;
    }

    .breadcrumb-active {
        color: white;
        font-weight: 700;
        padding: 6px 12px;
        border-radius: 25px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        display: flex;
        align-items: center;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    /* Enhanced Hero Content Layout */
    .enhanced-hero-content {
        position: relative;
        z-index: 10;
        max-width: 1200px;
        margin: 0 auto;
    }

    .category-header-wrapper {
        display: flex;
        flex-direction: column;
        gap: 3rem;
        align-items: center;
        text-align: center;
    }

    .category-main-info {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 2rem;
    }

    .category-text-content {
        max-width: 800px;
    }

    /* Enhanced Stats Cards */
    .category-stats-enhanced {
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .stats-cards-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 2rem;
        max-width: 800px;
        width: 100%;
    }

    .stat-card-enhanced {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        padding: 2rem 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(20px);
        transition: all 0.4s ease;
        position: relative;
        overflow: hidden;
        min-height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
        cursor: pointer;
    }

    .stat-card-enhanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        opacity: 0;
        transition: opacity 0.4s ease;
        border-radius: 20px;
    }

    .stat-card-enhanced:hover::before {
        opacity: 0.1;
    }

    .stat-card-enhanced:hover {
        transform: translateY(-8px) scale(1.05);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 255, 255, 0.4);
    }

    .stat-icon-wrapper {
        position: relative;
        z-index: 2;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .stat-card-enhanced:hover .stat-icon-wrapper {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
    }

    .stat-content {
        position: relative;
        z-index: 2;
        text-align: center;
    }

    .stat-content .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        margin-bottom: 0.5rem;
        line-height: 1;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .stat-content .stat-label {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 600;
        text-shadow: 0 1px 5px rgba(0, 0, 0, 0.2);
    }

    /* Category Hero Content */
    .category-icon-wrapper {
        margin-bottom: 2rem;
    }

    .category-hero-icon {
        font-size: 5rem;
        color: rgba(255, 255, 255, 0.9);
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    }

    .modern-category-title {
        font-size: 4rem;
        font-weight: 700;
        margin-bottom: 1rem;
        text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        line-height: 1.1;
    }

    .modern-category-desc {
        font-size: 1.3rem;
        font-weight: 400;
        margin-bottom: 3rem;
        opacity: 0.95;
        line-height: 1.6;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
    }

    /* Modern Stats Cards */
    .category-stats-modern {
        margin-bottom: 3rem;
    }

    .stats-grid {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .stat-card-modern {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        padding: 2rem 1.5rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(20px);
        min-width: 160px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .stat-card-modern:hover {
        background: rgba(255, 255, 255, 0.25);
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .stat-icon {
        font-size: 2rem;
        color: rgba(255, 255, 255, 0.8);
    }

    /* Enhanced Search Container */
    .category-search-container {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 20px;
        padding: 2rem;
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: visible;
        z-index: 50;
    }

    .search-filter-wrapper {
        display: flex;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
        position: relative;
        z-index: 60;
    }

    .search-input-group {
        position: relative;
        flex: 1;
        min-width: 300px;
        max-width: 400px;
    }

    /* Price Filter Group */
    .price-filter-group {
        display: flex;
        align-items: center;
        min-width: 250px;
    }

    .price-filter-group .input-group {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.3);
        transition: all 0.3s ease;
    }

    .price-filter-group .input-group:focus-within {
        border-color: white;
        background: white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    .price-filter-group .form-control {
        border: none;
        background: transparent;
        padding: 12px 15px;
        border-radius: 0;
        color: var(--text-primary);
    }

    .price-filter-group .form-control:focus {
        box-shadow: none;
        background: transparent;
        outline: none;
    }

    .price-filter-group .input-group-text {
        background: transparent;
        border: none;
        color: var(--text-muted);
        font-weight: 600;
    }

    /* Location Filter Group */
    .location-filter-group {
        position: relative;
        min-width: 200px;
    }

    .location-filter-group .form-control {
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50px;
        background: rgba(255, 255, 255, 0.9);
        padding: 12px 20px;
        transition: all 0.3s ease;
        color: var(--text-primary);
    }

    .location-filter-group .form-control:focus {
        outline: none;
        border-color: white;
        background: white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    /* Enhanced Dropdown Styles */
    .dropdown-item-text {
        padding: 8px 20px;
        color: inherit;
    }

    .dropdown-item-text:hover {
        background: none;
    }

    .dropdown-item-text .form-check {
        margin-bottom: 0;
    }

    .dropdown-item-text .form-check-input {
        margin-top: 0;
        margin-right: 0.5rem;
    }

    .dropdown-item-text .form-check-label {
        margin-bottom: 0;
        cursor: pointer;
        display: flex;
        align-items: center;
        width: 100%;
        padding: 4px 0;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .dropdown-item-text .form-check-input:checked + .form-check-label {
        color: var(--primary-color);
        font-weight: 600;
    }

    .dropdown-item-text:hover .form-check-label {
        color: var(--primary-color);
    }

    .search-icon-wrapper {
        position: absolute;
        left: 15px;
        top: 50%;
        transform: translateY(-50%);
        z-index: 5;
    }

    .search-icon {
        color: var(--text-muted);
        font-size: 1.1rem;
    }

    .modern-search-input {
        width: 100%;
        padding: 15px 50px 15px 45px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 50px;
        background: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        color: var(--text-primary);
        transition: all 0.3s ease;
    }

    .modern-search-input:focus {
        outline: none;
        border-color: white;
        background: white;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    .clear-search-btn {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-muted);
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: all 0.3s ease;
    }

    .clear-search-btn:hover {
        background: var(--danger-color);
        color: white;
    }

    /* Filter and View Toggle */
    .filter-dropdown-container, .view-toggle-container {
        position: relative;
        z-index: 100;
    }

    .modern-filter-btn {
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        color: white;
        padding: 12px 20px;
        border-radius: 50px;
        font-weight: 600;
        transition: all 0.3s ease;
        min-width: 140px;
    }

    .modern-filter-btn:hover {
        background: rgba(255, 255, 255, 0.3);
        border-color: white;
        color: white;
        transform: translateY(-2px);
    }

    .modern-dropdown-menu {
        background: white;
        border: none;
        border-radius: 15px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
        padding: 1rem 0;
        margin-top: 10px;
        min-width: 280px;
        max-height: 400px;
        overflow-y: auto;
        z-index: 1050;
        position: absolute;
        transform: translateY(0);
        animation: dropdownSlideIn 0.3s ease-out;
    }

    @keyframes dropdownSlideIn {
        0% {
            opacity: 0;
            transform: translateY(-10px) scale(0.95);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .modern-dropdown-menu .dropdown-item {
        padding: 10px 20px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
    }

    .modern-dropdown-menu .dropdown-item:hover {
        background: var(--primary-color);
        color: white;
    }

    .modern-dropdown-menu .dropdown-item.active {
        background: var(--secondary-color);
        color: white;
        font-weight: 600;
    }

    /* View Toggle Buttons - Enhanced */
    .view-toggle-container {
        display: flex;
        align-items: center;
        z-index: 100;
    }

    .view-toggle-buttons {
        display: flex;
        align-items: center;
    }

    .view-toggle-buttons .btn-group {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .view-toggle-buttons .btn-group .btn {
        border: none;
        padding: 12px 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        border-radius: 0;
    }

    .view-toggle-buttons .btn-group .btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        transform: translateY(-1px);
    }

    .view-toggle-buttons .btn-group .btn.active {
        background: var(--primary-color);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .view-toggle-group {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50px;
        overflow: hidden;
        border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .view-toggle-btn {
        background: transparent;
        border: none;
        color: white;
        padding: 12px 16px;
        transition: all 0.3s ease;
        border-radius: 0;
    }

    .view-toggle-btn.active {
        background: rgba(255, 255, 255, 0.3);
        color: white;
    }

    .view-toggle-btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }

    /* Enhanced Card Spacing for Both Themes */
    .category-card, .subcategory-card-modern, .modern-ad-card {
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
    }

    .category-card:hover, .subcategory-card-modern:hover, .modern-ad-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }

    /* Grid View Card Spacing */
    .ads-grid .row {
        --bs-gutter-x: 2rem;
        --bs-gutter-y: 2rem;
        margin: 0;
    }

    .ads-grid .col-12 {
        padding: 1rem;
    }

    /* List View Adaptations */
    .content-grid[data-view="list"] .modern-ad-card,
    .ads-grid[data-view="list"] .modern-ad-card {
        display: flex;
        flex-direction: row;
        height: auto;
        max-height: 200px;
        margin-bottom: 1rem;
    }

    .content-grid[data-view="list"] .ad-image-container,
    .ads-grid[data-view="list"] .ad-image-container {
        width: 250px;
        height: 180px;
        flex-shrink: 0;
    }

    .content-grid[data-view="list"] .ad-content,
    .ads-grid[data-view="list"] .ad-content {
        flex: 1;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    /* Modern Content Section */
    .modern-category-content {
        padding: 4rem 0;
        background: var(--bg-primary);
        position: relative;
    }

    /* Loading Overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .loading-spinner {
        text-align: center;
    }

    .spinner-ring {
        width: 60px;
        height: 60px;
        border: 4px solid rgba(var(--primary-color-rgb), 0.2);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-text {
        color: var(--text-muted);
        font-weight: 500;
    }

    /* No Results Message */
    .no-results-message {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--bg-secondary);
        border-radius: 20px;
        margin: 2rem 0;
    }

    .no-results-icon {
        font-size: 4rem;
        color: var(--text-muted);
        margin-bottom: 1.5rem;
    }

    .no-results-title {
        font-size: 2rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }

    .no-results-text {
        color: var(--text-muted);
        margin-bottom: 2rem;
        font-size: 1.1rem;
    }

    .reset-filters-btn {
        background: var(--primary-color);
        border: none;
        padding: 12px 24px;
        border-radius: 50px;
        color: white;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    .reset-filters-btn:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* Section Headers */
    .section-header-modern {
        background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary, #f8f9fa) 100%);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        flex-wrap: wrap;
        gap: 1rem;
        position: relative;
        overflow: visible;
    }

    .section-header-modern:hover {
        transform: translateY(-3px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    }

    .section-header-content {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex: 1;
        min-width: 0;
    }

    .section-icon-wrapper {
        font-size: 3rem;
        color: white;
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        position: relative;
        overflow: hidden;
    }

    .section-icon-wrapper::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transform: rotate(45deg);
        transition: all 0.6s ease;
        opacity: 0;
    }

    .section-header-modern:hover .section-icon-wrapper::before {
        opacity: 1;
        animation: shimmer 1.5s ease-in-out;
    }

    @keyframes shimmer {
        0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .section-content-header {
        flex: 1;
        min-width: 200px;
    }

    .section-title-modern {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .section-subtitle {
        color: var(--text-muted);
        font-size: 1rem;
        margin: 0;
        opacity: 0.8;
    }

    .section-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-shrink: 0;
    }

    .section-toggle, .section-stats {
        display: flex;
        align-items: center;
    }

    .section-toggle-btn {
        background: var(--primary-color);
        border: none;
        color: white;
        font-size: 1.2rem;
        padding: 12px;
        border-radius: 50%;
        transition: all 0.3s ease;
        width: 50px;
        height: 50px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .section-toggle-btn:hover {
        background: var(--secondary-color);
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .section-toggle-btn:active {
        transform: scale(0.95);
    }

    .section-toggle-btn i {
        transition: transform 0.3s ease;
    }

    .section-toggle-btn.collapsed i {
        transform: rotate(180deg);
    }

    .stats-badge {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        padding: 10px 18px;
        border-radius: 50px;
        font-weight: 600;
        font-size: 1rem;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        position: relative;
        overflow: hidden;
        min-width: 50px;
        text-align: center;
    }

    .stats-badge::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        transition: left 0.5s;
    }

    .section-header-modern:hover .stats-badge::before {
        left: 100%;
    }

    /* Section Content */
    .section-content-modern {
        margin-bottom: 3rem;
    }

    .content-grid {
        margin-bottom: 2rem;
    }

    .content-grid .row {
        --bs-gutter-x: 1.5rem;
        --bs-gutter-y: 1.5rem;
        margin: 0;
        row-gap: 1.5rem;
    }

    /* Bootstrap Grid Classes for Responsive Layout */
    .content-grid .bootstrap-ad-card {
        margin-bottom: 1.5rem;
        padding-left: 0.75rem;
        padding-right: 0.75rem;
    }

    /* List View: Single Column Layout */
    .content-grid[data-view="list"] .bootstrap-ad-card {
        width: 100% !important;
        max-width: 100% !important;
        flex: 0 0 100% !important;
    }

    /* Modern Subcategory Cards */
    .subcategory-card-modern {
        background: var(--bg-secondary);
        border-radius: 20px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        border: 1px solid var(--border-color);
        height: 100%;
        cursor: pointer;
        position: relative;
        overflow: hidden;
    }

    .subcategory-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .subcategory-card-modern:hover::before {
        transform: scaleX(1);
    }

    .subcategory-card-modern:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        border-color: var(--primary-color);
    }

    .card-header-modern {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .subcategory-icon-modern {
        font-size: 3rem;
        color: var(--primary-color);
        width: 70px;
        height: 70px;
        background: linear-gradient(135deg, rgba(var(--primary-color-rgb), 0.1) 0%, rgba(var(--secondary-color-rgb), 0.1) 100%);
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
    }

    .subcategory-badge-modern {
        background: var(--success-color);
        color: white;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        position: absolute;
        top: 1rem;
        right: 1rem;
    }

    .card-content-modern {
        margin-bottom: 1.5rem;
    }

    .subcategory-title-modern {
        font-size: 1.3rem;
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 1rem;
        min-height: 2.6rem;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .subcategory-stats-modern {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 1rem;
        gap: 1rem;
    }

    .stat-item-modern {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
    }

    .stat-count-modern {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--primary-color);
    }

    .stat-label-modern {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    .card-actions-modern {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
    }

    .card-actions-modern .btn {
        border-radius: 10px;
        font-size: 0.875rem;
        padding: 8px 16px;
    }

    /* Empty States */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: var(--bg-secondary);
        border-radius: 20px;
        border: 2px dashed var(--border-color);
    }

    .empty-icon {
        font-size: 4rem;
        color: var(--text-muted);
        margin-bottom: 1.5rem;
        opacity: 0.7;
    }

    .empty-title {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin-bottom: 1rem;
    }

    .empty-desc {
        color: var(--text-muted);
        margin-bottom: 2rem;
    }

    /* Modern Pagination */
    .pagination-modern {
        margin-top: 3rem;
    }

    .modern-page-link {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        color: var(--text-primary);
        padding: 12px 18px;
        margin: 0 3px;
        border-radius: 10px;
        text-decoration: none;
        transition: all 0.3s ease;
        font-weight: 500;
    }

    .modern-page-link:hover {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        transform: translateY(-2px);
    }

    .page-item.active .modern-page-link {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }

    /* Error State */
    .error-section {
        padding: 6rem 0;
        background: var(--bg-primary);
        min-height: 60vh;
        display: flex;
        align-items: center;
    }

    .error-state-modern {
        text-align: center;
        max-width: 600px;
        margin: 0 auto;
        padding: 3rem;
        background: var(--bg-secondary);
        border-radius: 20px;
        border: 1px solid var(--border-color);
    }

    .error-icon-wrapper {
        font-size: 5rem;
        color: var(--warning-color);
        margin-bottom: 2rem;
    }

    .error-title-modern {
        font-size: 2.5rem;
        color: var(--text-primary);
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .error-message-modern {
        color: var(--text-muted);
        margin-bottom: 3rem;
        font-size: 1.1rem;
        line-height: 1.6;
    }

    .error-actions-modern {
        display: flex;
        gap: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .modern-category-title {
            font-size: 2.5rem;
        }

        .modern-category-desc {
            font-size: 1.1rem;
        }

        .enhanced-breadcrumb {
            margin-bottom: 1.5rem;
        }

        .modern-breadcrumb-nav {
            padding: 10px 20px;
        }

        .category-header-wrapper {
            gap: 2rem;
        }

        .category-main-info {
            gap: 1.5rem;
        }

        .stats-cards-grid {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.5rem;
        }

        .stat-card-enhanced {
            padding: 1.5rem 1rem;
            min-height: 100px;
        }

        .stat-icon-wrapper {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }

        .stat-content .stat-number {
            font-size: 2rem;
        }

        .category-search-container {
            padding: 1.5rem;
        }

        .search-filter-wrapper {
            flex-direction: column;
            gap: 1rem;
        }

        .search-input-group {
            min-width: 100%;
            max-width: 100%;
        }

        .stats-grid {
            gap: 1rem;
        }

        .stat-card-modern {
            min-width: 140px;
            padding: 1.5rem 1rem;
            flex-direction: column;
            text-align: center;
            gap: 0.5rem;
        }

        .section-header-modern {
            padding: 1.5rem;
            text-align: center;
            flex-direction: column;
            gap: 1.5rem;
        }

        .section-header-content {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
        }

        .section-icon-wrapper {
            width: 60px;
            height: 60px;
            font-size: 2rem;
        }

        .section-title-modern {
            font-size: 1.5rem;
        }

        .section-actions {
            justify-content: center;
            gap: 2rem;
        }

        .content-grid[data-view="grid"] {
            grid-template-columns: 1fr;
        }

        .subcategory-card-modern {
            padding: 1rem;
        }

        .subcategory-icon-modern {
            font-size: 2rem;
            width: 50px;
            height: 50px;
        }

        .subcategory-title-modern {
            font-size: 1.1rem;
        }

        .error-actions-modern {
            flex-direction: column;
            align-items: center;
        }

        .error-actions-modern .btn {
            width: 200px;
        }
    }

    @media (max-width: 576px) {
        .modern-category-hero {
            min-height: 60vh;
            padding: 2rem 0;
        }

        .category-hero-icon {
            font-size: 3rem;
        }

        .modern-category-title {
            font-size: 2rem;
        }

        .enhanced-breadcrumb {
            margin-bottom: 1rem;
        }

        .modern-breadcrumb-nav {
            padding: 8px 16px;
            flex-direction: column;
            gap: 0.5rem;
        }

        .modern-breadcrumb-nav .breadcrumb-item {
            width: 100%;
            justify-content: center;
        }

        .modern-breadcrumb-nav .breadcrumb-item + .breadcrumb-item::before {
            content: "↓";
            margin: 4px 0;
            font-size: 1rem;
        }

        .category-header-wrapper {
            gap: 1.5rem;
        }

        .category-main-info {
            gap: 1rem;
        }

        .stats-cards-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
            max-width: 100%;
        }

        .stat-card-enhanced {
            padding: 1.2rem 1rem;
            min-height: 80px;
            flex-direction: row;
            gap: 1rem;
            text-align: left;
        }

        .stat-icon-wrapper {
            width: 45px;
            height: 45px;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .stat-content .stat-number {
            font-size: 1.8rem;
            margin-bottom: 0.25rem;
        }

        .stat-content .stat-label {
            font-size: 0.85rem;
        }

        .category-search-container {
            padding: 1rem;
            margin: 0 1rem;
        }

        .modern-category-content {
            padding: 2rem 0;
        }

        .container {
            padding-left: 1rem;
            padding-right: 1rem;
        }

        .section-header-modern {
            padding: 1rem;
            gap: 1rem;
        }

        .section-header-content {
            gap: 0.75rem;
        }

        .section-icon-wrapper {
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
        }

        .section-title-modern {
            font-size: 1.25rem;
        }

        .section-actions {
            gap: 1rem;
        }

        .stats-badge {
            padding: 8px 12px;
            font-size: 0.875rem;
        }

        .section-toggle-btn {
            width: 40px;
            height: 40px;
            font-size: 1rem;
        }

        .stats-grid {
            flex-direction: column;
            align-items: center;
        }

        .error-title-modern {
            font-size: 2rem;
        }
    }

    /* Dark Theme Support - Enhanced */
    [data-theme='dark'] .modern-search-input {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-color: rgba(255, 255, 255, 0.3);
    }

    [data-theme='dark'] .modern-search-input:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: var(--secondary-color);
        color: white;
    }

    [data-theme='dark'] .modern-search-input::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    [data-theme='dark'] .modern-dropdown-menu {
        background: #2d3748;
        border: 1px solid #4a5568;
        color: white;
    }

    [data-theme='dark'] .modern-dropdown-menu .dropdown-item:hover {
        background: var(--primary-color);
        color: white;
    }

    [data-theme='dark'] .modern-dropdown-menu .dropdown-item.active {
        background: var(--secondary-color);
        color: white;
    }

    /* Dark Theme View Toggle Buttons */
    [data-theme='dark'] .view-toggle-buttons .btn-group .btn {
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        border-color: rgba(255, 255, 255, 0.2);
    }

    [data-theme='dark'] .view-toggle-buttons .btn-group .btn:hover {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border-color: rgba(255, 255, 255, 0.3);
    }

    [data-theme='dark'] .view-toggle-buttons .btn-group .btn.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    /* Dark Theme Cards Enhancement */
    [data-theme='dark'] .modern-ad-card,
    [data-theme='dark'] .subcategory-card-modern {
        background: #2d3748;
        border-color: #4a5568;
        color: white;
    }

    [data-theme='dark'] .modern-ad-card:hover,
    [data-theme='dark'] .subcategory-card-modern:hover {
        background: #374151;
        border-color: #6b7280;
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    /* Dark Theme Filter Groups */
    [data-theme='dark'] .price-filter-group .input-group {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
    }

    [data-theme='dark'] .price-filter-group .input-group:focus-within {
        background: rgba(255, 255, 255, 0.15);
        border-color: var(--secondary-color);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }

    [data-theme='dark'] .price-filter-group .form-control {
        color: white;
    }

    [data-theme='dark'] .price-filter-group .form-control::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    [data-theme='dark'] .price-filter-group .input-group-text {
        color: rgba(255, 255, 255, 0.8);
    }

    [data-theme='dark'] .location-filter-group .form-control {
        background: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
        color: white;
    }

    [data-theme='dark'] .location-filter-group .form-control:focus {
        background: rgba(255, 255, 255, 0.15);
        border-color: var(--secondary-color);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        color: white;
    }

    [data-theme='dark'] .location-filter-group .form-control::placeholder {
        color: rgba(255, 255, 255, 0.7);
    }

    /* Dark Theme Dropdown Items */
    [data-theme='dark'] .dropdown-item-text .form-check-label {
        color: var(--text-primary);
    }

    [data-theme='dark'] .dropdown-item-text .form-check-input:checked + .form-check-label {
        color: var(--secondary-color);
    }

    [data-theme='dark'] .dropdown-item-text:hover .form-check-label {
        color: var(--secondary-color);
    }

    [data-theme='dark'] .dropdown-header {
        color: var(--text-muted);
        border-bottom-color: var(--border-color);
    }

    [data-theme='dark'] .section-header-modern {
        background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary, #2a2a2a) 100%);
    }

    [data-theme='dark'] .subcategory-card-modern {
        background: var(--bg-secondary);
        border-color: var(--border-color);
    }

    [data-theme='dark'] .subcategory-card-modern:hover {
        border-color: var(--secondary-color);
        box-shadow: 0 15px 40px rgba(255, 96, 1, 0.1);
    }

    [data-theme='dark'] .empty-state {
        background: var(--bg-secondary);
        border-color: var(--border-color);
    }

    [data-theme='dark'] .no-results-message {
        background: var(--bg-secondary);
    }

    [data-theme='dark'] .error-state-modern {
        background: var(--bg-secondary);
        border-color: var(--border-color);
    }

    /* Enhanced Dark Theme Support */
    [data-theme='dark'] .modern-breadcrumb-nav {
        background: rgba(0, 0, 0, 0.3);
        border-color: rgba(255, 255, 255, 0.1);
    }

    [data-theme='dark'] .breadcrumb-link {
        color: rgba(255, 255, 255, 0.8);
    }

    [data-theme='dark'] .breadcrumb-link:hover {
        color: white;
    }

    [data-theme='dark'] .stat-card-enhanced {
        background: rgba(0, 0, 0, 0.2);
        border-color: rgba(255, 255, 255, 0.1);
    }

    [data-theme='dark'] .stat-card-enhanced:hover {
        border-color: rgba(255, 255, 255, 0.2);
    }

    /* Dark Theme Form Controls */
    [data-theme='dark'] .form-check-input {
        background-color: rgba(255, 255, 255, 0.1);
        border-color: rgba(255, 255, 255, 0.3);
    }

    [data-theme='dark'] .form-check-input:checked {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
    }

    [data-theme='dark'] .form-check-input:focus {
        border-color: var(--secondary-color);
        box-shadow: 0 0 0 0.25rem rgba(255, 96, 1, 0.25);
    }

    /* Animation Classes */
    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .slide-up {
        animation: slideUp 0.3s ease-out;
    }

    @keyframes slideUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .scale-in {
        animation: scaleIn 0.4s ease-out;
    }

    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.9); }
        to { opacity: 1; transform: scale(1); }
    }

    /* Modern Ad Card Component Integration */
    .modern-ad-card {
        background: var(--bg-secondary);
        border-radius: 20px;
        overflow: hidden;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .modern-ad-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        border-color: var(--primary-color);
    }

    .ad-image-container {
        position: relative;
        height: 220px;
        overflow: hidden;
    }

    .ad-image-link {
        display: block;
        width: 100%;
        height: 100%;
    }

    .ad-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
    }

    .modern-ad-card:hover .ad-image {
        transform: scale(1.05);
    }

    .image-overlay-gradient {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(transparent, rgba(0, 0, 0, 0.5));
        pointer-events: none;
    }

    .ad-watermark {
        position: absolute;
        top: 15px;
        left: 15px;
        background: linear-gradient(135deg, #ffd700, #ffed4a);
        color: #333;
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .ad-badges-top {
        position: absolute;
        top: 15px;
        right: 15px;
        display: flex;
        gap: 8px;
        flex-direction: column;
        align-items: flex-end;
    }

    .excellence-badge {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
        color: white;
        padding: 6px 10px;
        border-radius: 15px;
        font-size: 0.8rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .ad-info-overlay {
        position: absolute;
        bottom: 15px;
        left: 15px;
        right: 15px;
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
    }

    .ad-quick-actions {
        display: flex;
        gap: 8px;
    }

    .quick-action-btn {
        width: 35px;
        height: 35px;
        background: rgba(255, 255, 255, 0.9);
        border: none;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        backdrop-filter: blur(10px);
    }

    .quick-action-btn:hover {
        background: var(--primary-color);
        color: white;
        transform: scale(1.1);
    }

    .ad-content {
        padding: 1.5rem;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .ad-header {
        margin-bottom: 1rem;
    }

    .ad-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        line-height: 1.4;
    }

    .ad-title a {
        color: var(--text-primary);
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .ad-title a:hover {
        color: var(--primary-color);
    }

    .ad-location {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }

    .ad-time-badge {
        background: var(--bg-tertiary);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.8rem;
        margin-left: auto;
    }

    .ad-features-modern {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .verified-badge-modern {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
    }

    .verified-company {
        background: rgba(52, 152, 219, 0.1);
        color: #3498db;
    }

    .verified-person {
        background: rgba(46, 204, 113, 0.1);
        color: #2ecc71;
    }

    .feature-pill {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        background: var(--bg-tertiary);
        color: var(--text-secondary);
    }

    .delivery-feature {
        background: rgba(52, 152, 219, 0.1);
        color: #3498db;
    }

    .video-feature {
        background: rgba(231, 76, 60, 0.1);
        color: #e74c3c;
    }

    .gallery-feature {
        background: rgba(155, 89, 182, 0.1);
        color: #9b59b6;
    }

    .featured-feature {
        background: rgba(241, 196, 15, 0.1);
        color: #f1c40f;
    }

    .ad-price-section {
        margin: 1rem 0;
        padding: 1rem;
        background: var(--bg-tertiary);
        border-radius: 15px;
        border-left: 4px solid var(--primary-color);
    }

    .ad-price-clean {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }

    .price-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .price-icon {
        color: var(--primary-color);
    }

    .price-amount {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .price-comparison {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: 0.2rem;
    }

    .original-price {
        text-decoration: line-through;
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    .discount-badge {
        background: var(--danger-color);
        color: white;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 0.7rem;
    }

    .ad-footer {
        padding: 1rem 1.5rem;
        background: var(--bg-tertiary);
        border-top: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .owner-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
        width: 100%;
    }

    .btn-edit {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background: var(--primary-color);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 0.9rem;
        transition: all 0.3s ease;
    }

    .btn-edit:hover {
        background: var(--secondary-color);
        transform: translateY(-2px);
    }

    .ad-stats-footer {
        margin-left: auto;
    }

    .stat-item {
        display: flex;
        align-items: center;
        gap: 0.3rem;
        color: var(--text-muted);
        font-size: 0.9rem;
    }

    .publisher-footer-info {
        display: flex;
        align-items: center;
        gap: 0.8rem;
    }

    .publisher-avatar-wrapper {
        position: relative;
    }

    .publisher-avatar-simple {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        object-fit: cover;
    }

    .avatar-badge {
        position: absolute;
        bottom: -2px;
        right: -2px;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: white;
        border: 2px solid white;
    }

    .company-badge {
        background: #3498db;
    }

    .person-badge {
        background: #2ecc71;
    }

    .publisher-info {
        display: flex;
        flex-direction: column;
        gap: 0.1rem;
    }

    .publisher-label {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    .publisher-name {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-primary);
    }

    .quality-indicator {
        position: absolute;
        top: -8px;
        right: 20px;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        color: white;
        border: 2px solid white;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .high-quality {
        background: #f1c40f;
    }

    .good-quality {
        background: #2ecc71;
    }

    /* Notification Toast */
    .notification-toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--primary-color);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        animation: slideInRight 0.3s ease-out;
    }

    @keyframes slideInRight {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    /* List view adaptations for modern card */
    .content-grid[data-view="list"] .modern-ad-card {
        flex-direction: row;
        height: auto;
    }

    .content-grid[data-view="list"] .ad-image-container {
        width: 250px;
        height: 180px;
        flex-shrink: 0;
    }

    .content-grid[data-view="list"] .ad-content {
        padding: 1rem 1.5rem;
    }
</style>
{% endblock extra_css %}
