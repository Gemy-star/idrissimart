{% load static i18n %}

<nav class="navbar navbar-expand-lg sticky-top" id="mainNav">
    <div class="container">
        <!-- Logo -->
        <a class="navbar-brand" href="{% url 'main:home' %}">
            <img src="{% static 'images/logos/logo.png' %}"
                 alt="Logo"
                 width="50"
                 height="50">
        </a>
        <!-- Desktop Navigation -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'main:home' %}">{% trans "الرئيسية" %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#categories">{% trans "الأقسام" %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#about">{% trans "من نحن" %}</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#contact">{% trans "اتصل بنا" %}</a>
                </li>
                <!-- Country Selector -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle country-selector"
                       href="#"
                       role="button"
                       data-bs-toggle="dropdown"
                       aria-label="Select Country">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        <span class="current-country" data-country-code="SA">🇸🇦</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end country-dropdown">
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="SA">
                                <span class="country-flag">🇸🇦</span>
                                <span class="country-name">{% trans "السعودية" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="AE">
                                <span class="country-flag">🇦🇪</span>
                                <span class="country-name">{% trans "الإمارات" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="EG">
                                <span class="country-flag">🇪🇬</span>
                                <span class="country-name">{% trans "مصر" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="KW">
                                <span class="country-flag">🇰🇼</span>
                                <span class="country-name">{% trans "الكويت" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="QA">
                                <span class="country-flag">🇶🇦</span>
                                <span class="country-name">{% trans "قطر" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="BH">
                                <span class="country-flag">🇧🇭</span>
                                <span class="country-name">{% trans "البحرين" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="OM">
                                <span class="country-flag">🇴🇲</span>
                                <span class="country-name">{% trans "عُمان" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item country-item" href="#" data-country="JO">
                                <span class="country-flag">🇯🇴</span>
                                <span class="country-name">{% trans "الأردن" %}</span>
                                <i class="fas fa-check country-check"></i>
                            </a>
                        </li>
                    </ul>
                </li>
                <!-- Language Switcher -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                        <i class="fas fa-globe me-1"></i>
                        <span class="current-lang">
                            {% get_current_language as LANGUAGE_CODE %}
                            {{ LANGUAGE_CODE|upper }}
                        </span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <form action="{% url 'set_language' %}" method="post">
                                {% csrf_token %}
                                <input name="next" type="hidden" value="{{ request.get_full_path }}">
                                <button type="submit" name="language" value="ar" class="dropdown-item">
                                    {% if LANGUAGE_CODE == 'ar' %}<i class="fas fa-check me-2"></i>{% endif %}
                                    العربية
                                </button>
                                <button type="submit" name="language" value="en" class="dropdown-item">
                                    {% if LANGUAGE_CODE == 'en' %}<i class="fas fa-check me-2"></i>{% endif %}
                                    English
                                </button>
                            </form>
                        </li>
                    </ul>
                </li>
                <!-- Wishlist with enhanced badge -->
                <li class="nav-item position-relative">
                    <a class="nav-link icon-link wishlist-link"
                       href="#"
                       title="{% trans 'المفضلة' %}">
                        <i class="fas fa-heart"></i>
                        <span class="enhanced-badge wishlist-badge">2</span>
                    </a>
                </li>
                <!-- Cart with enhanced badge -->
                <li class="nav-item position-relative">
                    <a class="nav-link icon-link cart-link"
                       href="#"
                       title="{% trans 'السلة' %}">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="enhanced-badge cart-badge">3</span>
                    </a>
                </li>
                <!-- Theme Toggle - Single Icon -->
                <li class="nav-item">
                    <button class="theme-toggle"
                            id="themeToggle"
                            type="button"
                            aria-label="{% trans 'تبديل النمط' %}">
                        <i class="fas fa-sun theme-icon-light"></i>
                        <i class="fas fa-moon theme-icon-dark"></i>
                    </button>
                </li>
                <!-- Login / Dashboard -->
                <li class="nav-item">
                    {% if request.user.is_authenticated %}
                        <a class="btn btn-custom btn-primary-custom ms-2" href="#">
                            <i class="fas fa-user me-2"></i>{{ request.user.first_name|default:"لوحة التحكم" }}
                        </a>
                        <a class="btn btn-custom btn-primary-custom ms-2"
                           href="{% url 'main:logout' %}">
                            <i class="fas fa-sign-out-alt"></i>{% trans "خروج" %}
                        </a>
                    {% else %}
                        <a class="btn btn-custom btn-primary-custom ms-2"
                           href="{% url 'main:login' %}">
                            <i class="fas fa-sign-in-alt me-2"></i>{% trans "دخول" %}
                        </a>
                    {% endif %}
                </li>
            </ul>
        </div>
        <!-- Hamburger (Mobile) -->
        <button class="hamburger d-lg-none"
                id="hamburgerBtn"
                type="button"
                aria-label="Toggle menu">
            <span></span><span></span><span></span>
        </button>
    </div>
    <!-- Mobile Nav -->
    <div class="mobile-nav" id="mobileNav">
        <button class="mobile-nav-close"
                id="mobileNavClose"
                type="button"
                aria-label="{% trans 'إغلاق القائمة' %}">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="24"
                 height="24"
                 fill="none"
                 stroke="currentColor"
                 stroke-width="2"
                 stroke-linecap="round"
                 stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
        <div class="mobile-nav-header">
            {% if request.user.is_authenticated %}
                <div class="mobile-user-info">
                    <div class="mobile-user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="mobile-user-details">
                        <span class="mobile-user-name">{{ request.user.get_full_name|default:request.user.username }}</span>
                        <span class="mobile-user-email">{{ request.user.email }}</span>
                    </div>
                </div>
            {% else %}
                <div class="mobile-guest-info">
                    <i class="fas fa-user-circle"></i>
                    <p>{% trans "مرحباً بك" %}</p>
                </div>
            {% endif %}
        </div>
        <ul class="mobile-nav-menu">
            <li>
                <a href="#home" class="mobile-nav-link"><i class="fas fa-home"></i><span>{% trans "الرئيسية" %}</span></a>
            </li>
            <li>
                <a href="#categories" class="mobile-nav-link"><i class="fas fa-th-large"></i><span>{% trans "الأقسام" %}</span></a>
            </li>
            <li>
                <a href="#about" class="mobile-nav-link"><i class="fas fa-info-circle"></i><span>{% trans "من نحن" %}</span></a>
            </li>
            <li>
                <a href="#contact" class="mobile-nav-link"><i class="fas fa-envelope"></i><span>{% trans "اتصل بنا" %}</span></a>
            </li>
            <!-- Theme Toggle - Single Icon -->
            <li class="nav-item">
                <a href="#"
                   class="theme-switcher"
                   id="themeToggle"
                   role="button"
                   aria-label="{% trans 'تبديل النمط' %}">
                    <i class="fas fa-sun theme-icon-light"></i>
                    <i class="fas fa-moon theme-icon-dark"></i>
                </a>
            </li>
            <li class="mobile-nav-divider"></li>
            {% if request.user.is_authenticated %}
                <li>
                    <a href="#" class="mobile-nav-link">
                        <i class="fas fa-heart"></i>
                        <span>{% trans "المفضلة" %}</span>
                        <span class="mobile-badge wishlist">2</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="mobile-nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span>{% trans "السلة" %}</span>
                        <span class="mobile-badge cart">3</span>
                    </a>
                </li>
                <li class="mobile-nav-divider"></li>
                <li>
                    <a href="#" class="mobile-nav-link"><i class="fas fa-tachometer-alt"></i><span>{% trans "لوحة التحكم" %}</span></a>
                </li>
                <li>
                    <a href="{% url 'main:logout' %}" class="mobile-nav-link logout"><i class="fas fa-sign-out-alt"></i><span>{% trans "تسجيل الخروج" %}</span></a>
                </li>
            {% else %}
                <li>
                    <a href="{% url 'main:login' %}" class="mobile-nav-link highlight"><i class="fas fa-sign-in-alt"></i><span>{% trans "تسجيل الدخول" %}</span></a>
                </li>
            {% endif %}
        </ul>
        <!-- Enhanced Mobile Country Selector -->
        <div class="mobile-country-selector">
            <div class="mobile-section-title">
                <i class="fas fa-map-marker-alt me-2"></i>{% trans "اختر البلد" %}
            </div>
            <button class="mobile-country-toggle"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#mobileCountryList"
                    aria-expanded="false"
                    aria-controls="mobileCountryList">
                <div class="current-selection">
                    <span class="country-flag-large">
                        {% for country in countries %}
                            {% if country.code == selected_country %}{{ country.flag }}{% endif %}
                        {% endfor %}
                    </span>
                    <span class="country-name-large">
                        {% for country in countries %}
                            {% if country.code == selected_country %}{{ country.name }}{% endif %}
                        {% endfor %}
                    </span>
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </button>
            <div class="collapse" id="mobileCountryList">
                <div class="country-list-wrapper">
                    {% for country in countries %}
                        <div class="mobile-country-item
                                    {% if country.code == selected_country %}active{% endif %}"
                             data-country="{{ country.code }}">
                            <div class="country-content">
                                <span class="country-flag-item">{{ country.flag }}</span>
                                <span class="country-name-item">{{ country.name }}</span>
                            </div>
                            {% if country.code == selected_country %}<i class="fas fa-check-circle check-icon"></i>{% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        <!-- Enhanced Mobile Language Switcher -->
        <div class="mobile-lang-selector mt-3">
            <div class="mobile-section-title">
                <i class="fas fa-globe me-2"></i>{% trans "اختر اللغة" %}
            </div>
            <button class="mobile-lang-toggle"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#mobileLangList"
                    aria-expanded="false"
                    aria-controls="mobileLangList">
                <div class="current-selection">
                    {% if LANGUAGE_CODE == 'ar' %}
                        <span class="lang-name-large">العربية</span>
                    {% else %}
                        <span class="lang-name-large">English</span>
                    {% endif %}
                </div>
                <i class="fas fa-chevron-down toggle-icon"></i>
            </button>
            <div class="collapse" id="mobileLangList">
                <div class="language-list-wrapper">
                    <form action="{% url 'set_language' %}" method="post">
                        {% csrf_token %}
                        <input name="next" type="hidden" value="{{ request.get_full_path }}">
                        <button type="submit"
                                name="language"
                                value="ar"
                                class="mobile-lang-item
                                       {% if LANGUAGE_CODE == 'ar' %}active{% endif %}">
                            {% if LANGUAGE_CODE == 'ar' %}<i class="fas fa-check-circle me-2"></i>{% endif %}
                            العربية
                        </button>
                        <button type="submit"
                                name="language"
                                value="en"
                                class="mobile-lang-item
                                       {% if LANGUAGE_CODE == 'en' %}active{% endif %}">
                            {% if LANGUAGE_CODE == 'en' %}<i class="fas fa-check-circle me-2"></i>{% endif %}
                            English
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="mobile-nav-backdrop" id="mobileBackdrop"></div>
</nav>
