{% load i18n idrissimart_tags %}

<div class="modern-ad-card">
    <div class="ad-image-container">
        <a href="{{ ad.get_absolute_url }}" class="ad-image-link">
            {% if ad.images.first %}
                <img src="{{ ad.images.first.image.url }}"
                     class="ad-image"
                     alt="{{ ad.title }}"
                     loading="lazy">
            {% else %}
                <div class="ad-image-placeholder">
                    <i class="fas fa-image"></i>
                    <span>{% trans "No Image" %}</span>
                </div>
            {% endif %}
        </a>

        <div class="ad-badges-top">
            <div class="ad-badges-container">
                {% if ad.is_featured %}
                    <span class="ad-badge featured-badge">
                        <i class="fas fa-star"></i>
                        <span>{% trans "Featured" %}</span>
                    </span>
                {% endif %}
                {% if ad.is_urgent %}
                    <span class="ad-badge urgent-badge">
                        <i class="fas fa-bolt"></i>
                        <span>{% trans "Urgent" %}</span>
                    </span>
                {% endif %}
            </div>
        </div>

        <div class="ad-info-overlay">
            <div class="ad-stats-container">
                <span class="ad-stat-item">
                    <i class="fas fa-eye"></i>
                    {{ ad.views_count|default:0 }}
                </span>
                {% if ad.is_delivery_available %}
                <span class="ad-stat-item delivery-available">
                    <i class="fas fa-shipping-fast"></i>
                    {% trans "Delivery" %}
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="ad-content">
        <div class="ad-header">
            <h3 class="ad-title">
                <a href="{{ ad.get_absolute_url }}">{{ ad.title|truncatewords:7 }}</a>
            </h3>
            <div class="ad-location">
                <i class="fas fa-map-marker-alt"></i>
                <span>{{ ad.city }}</span>
            </div>
        </div>

        <p class="ad-description">{{ ad.description|striptags|truncatewords:12 }}</p>

        <div class="ad-price-section">
            <div class="ad-price">
                {% ad_price_formatted ad as formatted_price %}
                <span class="price-amount">{{ formatted_price|default_if_none:ad.price }}</span>
                <span class="price-currency">{{ ad.currency|default:"EGP" }}</span>
            </div>

            {% if ad.is_negotiable %}
            <div class="ad-price-meta">
                <span class="negotiable-badge">
                    <i class="fas fa-handshake"></i>
                    {% trans "Negotiable" %}
                </span>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="ad-footer">
        <div class="ad-author">
            <div class="author-info">
                {% user_avatar user=ad.user size=32 css_class="author-avatar" %}
                <div class="author-details">
                    <span class="author-name">{{ ad.user.get_full_name|default:ad.user.username }}</span>
                    {% if ad.user.is_verified %}
                    <span class="verification-badge">
                        <i class="fas fa-check-circle"></i>
                        {% trans "Verified" %}
                    </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
